<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<!--<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>-->    

    <ui:composition template="/template.xhtml">
        <ui:define name="head">

        </ui:define>

        <ui:define name="body">

            <f:event type="preRenderView" listener="#{agenteController.findAgente(request.getUserPrincipal().toString())}" ></f:event>
            <p:ajaxStatus onstart="PF('statusDialog').show();" onsuccess="PF('statusDialog').hide();"/>  

            <p:dialog modal="true" widgetVar="statusDialog" header="Espere Por Favor"   
                      draggable="false" closable="false"> 
                <div align="center">
                    <p:graphicImage value="/resources/img/ajaxloadingbar.gif" /> 
                </div>
            </p:dialog>  

            <h:form id="formprincipal" enctype="multipart/form-data" >
                <p:growl globalOnly="true" for="growlprincipal" id="growlprincipal" showDetail="true" sticky="true" />

                <p:panel id="pprincipal" header="Alta Idea-Proyecto" style="padding: 0px; width: 950px; margin: 0 auto; overflow: hidden;">

                    <div align="right" style="margin: 10px;">
                        <p:clock pattern="dd.MM.yyyy HH:mm:ss " />  
                    </div>

                    <p:panel header="Título de la Idea Proyecto" id="titulo" style="margin-bottom:10px;" >
                        <p:inputText required="true" requiredMessage="Ingrese el titulo del proyecto" style="font-weight:bold;font-size:larger;width: 100%"  id="nombre" value="#{proyectoController.selected.nombre}" title="Nombre del Proyecto" />
                        <br />
                    </p:panel>

                    <p:panelGrid styleClass="sinBordes sinFondo" columnClasses="left,right" style="width: 100%; margin: 0; padding: 0; ">                    
                        <p:row>
                            <p:column style="width:50%; padding-left: 0px;">
                                <p:panel header="Tipo de Proyecto" style="margin: 0px 0px 10px 0px; width: 100%;"  >  
                                    <p:selectOneMenu id="tipoproyectoid" value="#{proyectoController.selected.tipoproyectoid}" required="true" requiredMessage="Seleccione Tipo de Proyecto" style="width: 100%;">
                                        <f:selectItems value="#{tipoproyectoController.itemsAvailableSelectOne}"/>
                                    </p:selectOneMenu>    
                                </p:panel>                            
                            </p:column>

                            <p:column style="width:50%; padding-right: 6px;">
                                <p:panel header="Avance de la Idea-Proyecto" style="margin: 0px 0px 10px 0px; width: 100%;">             
                                    <p:selectOneMenu widgetVar="wavanceproyectoid" id="avanceproyectoid"  value="#{proyectoController.selected.avanceproyectoid}" label="Avance Proyecto" required="true" requiredMessage="Seleccione el estado de avance" style="width: 100%;" >
                                        <f:selectItems  value="#{avanceproyectoController.itemsAvailableSelectOne}"/>
                                    </p:selectOneMenu>
                                </p:panel>                            
                            </p:column>
                        </p:row>                        
                    </p:panelGrid>

                    <p:tabView id="tabviewTodo" style="font-size: 12px;"> 

                        <p:tab title="Comitente y Responsable">

                            <p:fieldset legend="Comitente" style="margin-bottom:5px">
                                <p:panelGrid id="pcomitente" styleClass="sinBordes sinFondo" style="width: 100%;"> 
                                    <p:row>
                                        <p:column style="width: 200px;">
                                            <p:selectOneRadio id="options" value="#{proyectoController.habilitarcomitente}"   >  
                                                <f:selectItem itemLabel="No" itemValue="0"  />  
                                                <f:selectItem itemLabel="Si" itemValue="1" />  
                                                <p:ajax update="pcomitente" event="valueChange" />
                                            </p:selectOneRadio>                                    
                                        </p:column>
                                        <p:column style="width: 750px;">
                                            <p:panel id="phabilitarcomitente" rendered="#{proyectoController.habilitarcomitente eq 1}" >
                                                <p:panelGrid styleClass="sinBordes" >
                                                    <p:row>
                                                        <p:column>
                                                            <p:outputLabel style="font-weight:bold;"  value="Ingrese el N° de CUIT/CUIL"  />                 
                                                        </p:column>
                                                        <p:column>
                                                            <p:selectOneMenu widgetVar="comitentedid" id="comitenteid"  value="#{proyectoController.selected.comitenteid}" label="Comitente" filter="true" filterMatchMode="contains"  >
                                                                <f:selectItems  value="#{comitenteController.itemsAvailableSelectOne}"/>
                                                                <p:ajax update="pgcomitente,:formDetallesComitente:detallesComitente" event="change" />
                                                            </p:selectOneMenu>                                                    
                                                        </p:column>
                                                    </p:row>
                                                </p:panelGrid>

                                                <p:separator rendered="#{not empty proyectoController.selected.comitenteid.razonsocial}"/>

                                                <p:panelGrid id="pgcomitente" styleClass="sinBordes sinFondo" style="width: 100%;" >
                                                    <p:row rendered="#{not empty proyectoController.selected.comitenteid.razonsocial}">
                                                        <p:column><p:outputLabel style="font-weight:bold;" value="Tipo"/></p:column>
                                                        <p:column><p:outputLabel style="font-weight:bold;" value="Contacto"/></p:column>
                                                        <p:column><p:outputLabel style="font-weight:bold;" value="Cargo del Contacto"/></p:column>
                                                        <p:column><p:outputLabel style="font-weight:bold;" value="Sector" /></p:column>
                                                        <p:column></p:column>
                                                    </p:row>
                                                    <p:row rendered="#{not empty proyectoController.selected.comitenteid.razonsocial}">
                                                        <p:column>
                                                            <p:outputLabel value="#{proyectoController.selected.comitenteid.tipocomitenteid.tipocomitente}" title="Tipo" rendered="#{not empty proyectoController.selected.comitenteid.razonsocial}"/>                                                                                                                        
                                                        </p:column> 
                                                        <p:column>
                                                            <p:outputLabel value="#{proyectoController.selected.comitenteid.contacto}" title="Contacto" rendered="#{not empty proyectoController.selected.comitenteid.razonsocial}"/>
                                                        </p:column> 
                                                        <p:column>
                                                            <p:outputLabel value="#{proyectoController.selected.comitenteid.cargocontacto}" title="Cargo del Contacto" rendered="#{not empty proyectoController.selected.comitenteid.razonsocial}"/>
                                                        </p:column> 
                                                        <p:column>
                                                            <p:outputLabel value="#{proyectoController.selected.comitenteid.sectorid.sector}" title="Sector" rendered="#{not empty proyectoController.selected.comitenteid.sectorid.sector}"/>
                                                        </p:column> 
                                                        <p:column>

                                                            <p:commandButton rendered="#{proyectoController.selected.comitenteid ne null}" id="detalleComitenteBtn" value="Detalles" icon="ui-icon-search"  
                                                                             onclick="PF('detallesComitente').show()" immediate="true" />  
                                                        </p:column> 
                                                    </p:row>
                                                </p:panelGrid>                                                    


                                                <p:separator />

                                                <!--<p:commandButton value="Agregar Persona" onclick="PF('dregistrar').show();" ></p:commandButton>-->
                                                <!--<p:commandButton value="Crear Comitente" onclick="dcomitentecrear.show()" immediate="true"  />-->
                                                <p:commandButton value="Crear Comitente" onclick="PF('dcomitentecrear').show();" immediate="true"  />

                                            </p:panel>

                                        </p:column>
                                    </p:row>

                                </p:panelGrid>
                            </p:fieldset>


                            <p:fieldset legend="Responsable Técnico" style="margin-bottom:5px">
                                <!-- RESPONSABLE TECNICO -->
                                <p:panelGrid id="pagente" columns="7"  styleClass="sinBordes sinFondo" style="width: 100%;" >  

                                    <p:outputLabel style="font-weight:bold;" value="Apellido"/>
                                    <p:outputLabel style="font-weight:bold;" value="Nombres"/>
                                    <p:outputLabel style="font-weight:bold;" value="Documento"/>
                                    <p:outputLabel style="font-weight:bold;" value="Profesion"/>
                                    <p:outputLabel style="font-weight:bold;" value="Especialidad"/>                            
                                    <p:outputLabel style="font-weight:bold;" value="Email"/>
                                    <p:outputLabel style="font-weight:bold;" value="Dependencia"/>
                                    <p:outputLabel value="#{agenteController.selected.apellido}" title="Apellido" />
                                    <p:outputLabel value="#{agenteController.selected.nombres}" title="Nombres" />
                                    <p:outputLabel value="#{agenteController.selected.tipodocumentoid.tipodocumento} - #{agenteController.selected.numerodocumento}" title="Tipo de Documento" rendered="#{not empty agenteController.selected.tipodocumentoid.tipodocumento}"/>
                                    <p:outputLabel value="#{agenteController.selected.profesion}" title="Profesion" />
                                    <p:outputLabel value="#{agenteController.selected.especialidad}" title="Especialidad" />                            
                                    <p:outputLabel value="#{agenteController.selected.email}" title="Email" />
                                    <p:outputLabel value="#{agenteController.selected.dependenciaid.dependencia}" title="Dependencia" />
                                </p:panelGrid>       
                                <p:separator />

                                <!--<p:commandButton onclick="dagenteeditar.show()" type="button" value="Editar Responsable Técnico" />-->                                 
                                <p:commandButton value="Editar Responsable Técnico" onclick="PF('dagenteeditar').show();" immediate="true"  />
                            </p:fieldset>


                        </p:tab>

                        <p:tab title="Descripción y Documentación">

                            <p:fieldset legend="Descripción de la Idea-Proyecto" style="margin-bottom:5px">
                                <!-- DESCRIPCIÓN -->
                                <p:panelGrid columnClasses="right,left" styleClass="sinBordes sinFondo" style="width: 100%;">
                                    <p:row>
                                        <p:column style="width: 100%;" colspan="2">
                                            <p:outputLabel style="font-weight:bold;font-size:larger"  value="Diagnostico y resumen descriptivo" for="resumen" />                                            
                                            <p:inputTextarea rows="5" id="resumen" value="#{proyectoController.selected.resumen}" title="Resumen" autoResize="true" required="true" requiredMessage="Ingrese Diagnostico y resumen descriptivo " style="width: 100%;" />
                                        </p:column>
                                    </p:row>
                                    <p:row>
                                        <p:column style="width: 100%;" colspan="2" >
                                            <p:outputLabel style="font-weight:bold;font-size:larger" value="Objetivos y Resultados Esperados" for="observaciones" />                                                                                
                                            <p:inputTextarea rows="3" id="observaciones" value="#{proyectoController.selected.observaciones}" title="Observaciones" autoResize="true" required="true" requiredMessage="Objetivos y Resultados Esperados" style="width: 100%;"/>
                                        </p:column>                                
                                    </p:row>

                                    <p:row>
                                        <p:column style="width: 25%;">
                                            <p:outputLabel style="font-weight:bold;font-size:larger" value="Lugar (Domicilio)" for="localizacion" />
                                        </p:column>
                                        <p:column style="width: 75%;">
                                            <p:inputTextarea rows="1" id="localizacion" value="#{proyectoController.selected.localizacion}" title="localizacion" placeholder="Por ejemplo = Martin Fierro 1054 - Chilecito, La Rioja" required="true" requiredMessage="Ingrese la localización" style="width: 100%;" />
                                        </p:column>                                
                                    </p:row>
                                    <p:row>
                                        <p:column style="width: 25%;">
                                            <p:outputLabel style="font-weight:bold;font-size:larger" value="Duración (Meses)" for="duracion" />
                                        </p:column>
                                        <p:column style="width: 75%;">
                                            <p:spinner maxlength="3" id="duracion" value="#{proyectoController.selected.duracion}" title="duracion" min="1"  />
                                        </p:column>                                
                                    </p:row>
                                </p:panelGrid>                                
                            </p:fieldset>

                            <p:fieldset legend="Documentación" style="margin-bottom:5px">
                                <!-- DOCUMENTACION -->
                                <h:panelGrid cellpadding="2" cellspacing="10" columnClasses="right,left" columns="3">    

                                    <h:form id="fupload" enctype="multipart/form-data">
                                        <p:fileUpload label="Documentacion para subir" id="documentacion" fileUploadListener="#{archivoproyectoController.handleFileUpload}" mode="advanced"  
                                                      sizeLimit="10000000" multiple="true" auto="true" allowTypes="/(\.|\/)(gif|jpe?g|png|doc|docx|pdf)$/" update=":formprincipal:tabviewTodo:tdocumentacionnombre1"   >

                                        </p:fileUpload>    
                                    </h:form>
                                    <p:dataTable id="tdocumentacionnombre1" var="arc" value="#{archivoproyectoController.collectorArchivoProyecto}" >  

                                        <p:column headerText="Archivos">  
                                            <h:outputText value="#{arc.nombre}" />  
                                        </p:column> 
                                        <p:column headerText="">  
                                            <p:commandLink immediate="true" value="Eliminar" action="#{archivoproyectoController.removerArchivoCollection}" update=":formprincipal:tabviewTodo:tdocumentacionnombre1"  >
                                                <f:setPropertyActionListener value="#{arc}" target="#{archivoproyectoController.selected}" />  
                                            </p:commandLink>
                                        </p:column> 
                                    </p:dataTable>

                                </h:panelGrid>         
                            </p:fieldset>

                        </p:tab>
                        <p:tab title="Financiamiento y Convocatoria">
                            <p:panelGrid columnClasses="right,left" styleClass="sinBordes sinFondo" style="width: 100%;">
                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="font-weight:bold;font-size:larger"  value="Beneficiario" for="beneficiarioid" />
                                    </p:column>
                                    <p:column style="width: 50%;" >
                                        <p:selectOneMenu widgetVar="beneficiarioid" id="beneficiarioid" value="#{proyectoController.selected.beneficiarioid}" label="Beneficiario" required="true" requiredMessage="Seleccione Beneficiario" style="width:100%;">
                                            <f:selectItems value="#{beneficiarioController.itemsAvailableSelectOne}"/>
                                        </p:selectOneMenu>
                                    </p:column>
                                    <p:column>
                                        <p:outputLabel style="font-weight:bold;font-size:larger"  value="Fuente de Financiamiento" for="fuentefinanciamientoid" />
                                    </p:column>
                                    <p:column style="width: 50%;">
                                        <p:selectOneMenu widgetVar="fuentefinanciamientoid" id="fuentefinanciamientoid" value="#{proyectoController.selected.fuentefinanciamientoid}" label="Fuente de Financiamiento" required="true" requiredMessage="Seleccione Fuente de Financiamiento" style="width:100%;" >
                                            <f:selectItems value="#{fuentefinanciamientoController.itemsAvailableSelectOne}"/>
                                        </p:selectOneMenu>
                                    </p:column>                                
                                </p:row>

                                <p:row>
                                    <p:column>
                                        <p:outputLabel style="font-weight:bold;font-size:larger"  value="Tipo de Financiamiento" for="tipofinanciamientoid" />
                                    </p:column>
                                    <p:column colspan="3">
                                        <p:selectOneMenu widgetVar="tipofinanciamientoid" id="tipofinanciamientoid" value="#{proyectoController.selected.tipofinanciamientoid}" label="Tipo de Financiamiento" required="true" requiredMessage="Seleccione el Tipo de Financiamiento" style="width: 100%;" >
                                            <f:selectItems value="#{tipofinanciamientoController.itemsAvailableSelectOne}"/>
                                            <p:ajax update="tconvocatoria" listener="#{convocatoriaController.findConvocatoriafinanciamiento(null, proyectoController.selected.tipofinanciamientoid.id)}" />  
                                        </p:selectOneMenu>
                                    </p:column>                                
                                </p:row>
                            </p:panelGrid>
                            <p:fieldset legend="Convocatoria" style="margin-bottom:5px">
                                
                                <p:dataTable widgetVar="wconvocatoria" paginator="true" id="tconvocatoria" var="conv" 
                                            value="#{convocatoriaController.items}" 
                                            selection="#{convocatoriaController.selected}" 
                                            selectionMode="single" rowKey="#{conv.id}" 
                                            paginatorPosition="bottom" paginatorAlwaysVisible="false" 
                                            rowIndexVar="indice" 
                                            rowStyleClass="#{(indice mod 2) eq 0 ? 'filaResaltada1' : 'filaResaltada2'}"
                                            styleClass="tabla">  
                                    <f:facet name="header">
                                        Seleccionar la Convocatoria
                                    </f:facet>
                                    <p:column headerText="Convocatoria">  
                                        <h:outputText value="#{conv.convocatoria}" />  
                                    </p:column> 

                                    <p:column headerText="Organismo">  
                                        <h:outputText value="#{conv.organismo}" />  
                                    </p:column> 
                                    <p:column headerText="Tipo de Proyecto" sortBy="tipo"  >  
                                        <h:outputText value="#{conv.tipoproyectoid.tipo}" />  
                                    </p:column>
                                    <p:column headerText="Monto Financiamiento">  
                                        <h:outputText value="#{conv.montofinanciamiento}" />  
                                    </p:column> 
                                    <p:column headerText="Fecha de Cierre">  
                                        <h:outputText value="#{conv.fechacierre}" />  
                                    </p:column> 
                                    <p:column headerText="Link"> 
                                        <a target="_blank" href="#{conv.link}" >LINK</a>

                                    </p:column> 
                                    <p:column headerText="Estado">  
                                        <p:outputLabel value="#{conv.estado}"  />
                                    </p:column>


                                    <f:facet name="footer">  
                                        <p:commandButton rendered="#{convocatoriaController.selected ne null}" id="viewButton" value="Ver Registro" icon="ui-icon-search"  
                                                         update="@widgetVar(dconvocatoria)" oncomplete="PF('dconvocatoria').show()" />  
                                    </f:facet>  
                                </p:dataTable>               
                            </p:fieldset>

                        </p:tab>

                        <p:tab title="Presupuesto">

                            <p:fieldset legend="Presupuesto" style="margin-bottom:5px">

                                <p:dataTable id="tpresupuesto" value="#{presupuestoRubroController.presupuestosrubros}"  
                                            var="item" editable="true" editMode="cell" style="width:100%;" 
                                            rowIndexVar="indice" 
                                            rowStyleClass="#{(indice mod 2) eq 0 ? 'filaResaltada1' : 'filaResaltada2'}"
                                            styleClass="tabla"
                                            >
                                <!-- <p:ajax process="@this" partialSubmit="true" update="@this, :formprincipal:caportes" event="cellEdit"  listener="{presupuestoRubroController.sumarGastos}" /> -->
                                    <p:ajax event="cellEdit" listener="#{presupuestoRubroController.sumarGastos}" update=":formprincipal:tabviewTodo:caportes,:formprincipal:tabviewTodo:crubros,:formprincipal:growlprincipal, :formprincipal:tabviewTodo:tpresupuestototales" />  
                                    <f:facet name="header">
                                        Armar el Presupuesto de la Idea-Proyecto
                                    </f:facet>
                                    <p:column style="width:20%" styleClass="center">
                                        <f:facet name="header">
                                            <h:outputText value="Rubro"/>
                                        </f:facet>
                                        <h:outputText style="width:96%;" value="#{item.rubro.abreviado}" />
                                    </p:column>

                                    <p:column style="width:20%; " >
                                        <f:facet name="header">
                                            <h:outputText value="Aporte Organismo" style="font-weight: bold;" title="Click en la celda e ingrese el importe."/>
                                        </f:facet>
                                        <p:cellEditor>  
                                            <f:facet name="output">
                                                <h:outputText value="$ #{item.gastoorganismo}" style="float: right;">
                                                    <f:convertNumber pattern="#0.00" />
                                                </h:outputText>
                                            </f:facet>  
                                            <f:facet name="input">
                                                <p:inputText style="width:96%; " id="gastoorganismo" value="#{item.gastoorganismo}" >
                                                    <p:ajax event="change" update="totalRubro" />
                                                </p:inputText>
                                            </f:facet> 
                                        </p:cellEditor> 
                                    </p:column>

                                    <p:column style="width:20%;" >
                                        <f:facet name="header">
                                            <h:outputText value="Aporte Comitente" style="font-weight: bold;" title="Click en la celda e ingrese el importe."/>
                                        </f:facet>
                                        <p:cellEditor >  
                                            <f:facet name="output">
                                                <h:outputText value="$ #{item.gastocomitente}" style="float: right;" >
                                                    <f:convertNumber pattern="#0.00" />
                                                </h:outputText>
                                            </f:facet>  
                                            <f:facet name="input">
                                                <p:inputText style="width:96%; " id="gastocomitente" value="#{item.gastocomitente}">
                                                    <p:ajax event="change" update="totalRubro" />
                                                </p:inputText>
                                            </f:facet> 
                                        </p:cellEditor>  

                                    </p:column>

                                    <p:column style="width:20%;" >
                                        <f:facet name="header">
                                            <h:outputText value="Aporte Universidad" style="font-weight: bold;" title="Click en la celda e ingrese el importe."/>
                                        </f:facet>
                                        <p:cellEditor>  
                                            <f:facet name="output">
                                                <h:outputText value="$ #{item.gastouniversidad}" style="float: right;" >
                                                    <f:convertNumber pattern="#0.00" />
                                                </h:outputText>
                                            </f:facet>  
                                            <f:facet name="input">
                                                <p:inputText style="width:96%; " id="gastouniversidad" value="#{item.gastouniversidad}" >
                                                    <p:ajax event="change" update="totalRubro" />
                                                </p:inputText>
                                            </f:facet>  
                                        </p:cellEditor> 
                                    </p:column>

                                    <p:column headerText="Totales Rubros" style="width:20%;"  >
                                        <p:outputLabel id="totalRubro" value="$ #{item.total}" style="float: right;" >
                                            <f:convertNumber pattern="#0.00" />
                                        </p:outputLabel>
                                    </p:column>

                                </p:dataTable> 

                                <p:remoteCommand name="actualizar" update=":formprincipal:tabviewTodo:tpresupuesto:totalRubro" />

                                <p:dataTable id="tpresupuestototales" value="#{presupuestoRubroController.presupuestosrubros}"  
                                            var="item" rows="1" 
                                            rowIndexVar="indice" 
                                            rowStyleClass="#{(fn:length(presupuestoRubroController.presupuestosrubros) mod 2) eq 0 ? 'filaResaltada1' : 'filaResaltada2' }"
                                            styleClass="tabla esconder-cabecera-columnas">
                                    
                                    <p:column style="width:20%" styleClass="center">
                                        <h:outputText style="width:96%; font-weight: bold;" value="Totales"/>
                                    </p:column>

                                    <p:column style="width:20%; ">
                                        <h:outputText value="$ #{presupuestoRubroController.obtenerTotalGastosOrganismo()}" style="float: right; font-weight: bold;">
                                            <f:convertNumber pattern="#0.00" />
                                        </h:outputText>
                                    </p:column>

                                    <p:column style="width:20%;">
                                        <h:outputText value="$ #{presupuestoRubroController.obtenerTotalGastosComitente()}" style="float: right; font-weight: bold;">
                                            <f:convertNumber pattern="#0.00" />
                                        </h:outputText>
                                    </p:column>

                                    <p:column style="width:20%;">
                                        <h:outputText value="$ #{presupuestoRubroController.obtenerTotalGastosUniversidad()}" style="float: right; font-weight: bold;">
                                            <f:convertNumber pattern="#0.00" />
                                        </h:outputText>
                                    </p:column>

                                    <p:column id="totalesRubro" style="width:20%;" >
                                        <h:outputText value="$ #{presupuestoRubroController.obtenerTotalGeneral()}" style="float: right; font-weight: bold;">
                                            <f:convertNumber pattern="#0.00" />
                                        </h:outputText>
                                    </p:column>
                                </p:dataTable> 

                            </p:fieldset>

                            <br />
                            <p:separator />     

                            <!-- GRAFICOS -->

                            <h:panelGrid columns="2" style="margin-left: auto; margin-right: auto;">

                                <p:chart type="pie" id="caportes" model="#{presupuestoRubroController.pieModel}" style="width:100%;height:300px"  /> 

                                <p:chart type="pie" id="crubros" model="#{presupuestoRubroController.pieModelRubro}" style="width:100%;height:300px" /> 

                            </h:panelGrid>

                        </p:tab>

                        <p:tab title="Equipo de trabajo">
                            <h:panelGrid columns="4">
                                <p:outputLabel style="font-weight: bold" value="Ingrese N° de Documento / Cuil " ></p:outputLabel>
                                <p:selectOneMenu  id="advancedfiltroa" value="#{agenteViewController.selected}" filter="true" filterMatchMode="contains"    >
                                    <!--<p:ajax update="@this, agregaraequipo" />-->
                                    <p:ajax update="agregaraequipo" />
                                    <f:selectItems value="#{agenteViewController.itemsAvailableSelectOne}"  />

                                </p:selectOneMenu> 

                                <h:panelGrid columns="6" id="agenteselecciona" >
                                    <p:commandButton title="Agregar al Equipo de Trabajo de la Idea-Proyecto" icon="ui-icon-plus" id="agregaraequipo" immediate="true" update="agentesa" action="#{proyectoAgenteController.agregarEquipo}" disabled="${empty agenteViewController.selected.apellido ? 'true' : 'false'}" />
                                    <p:commandButton title="Nueva Persona" icon="ui-icon-person" onclick="PF('dregistrar').show();" />
                                </h:panelGrid>
                            </h:panelGrid>

                            <div align="center">
                                <p:dataTable id="agentesa" value="#{proyectoAgenteController.equipotrabajo}" 
                                            var="agentea" editable="true" editMode="cell" 
                                            rowIndexVar="indice" 
                                            rowStyleClass="#{(indice mod 2) eq 0 ? 'filaResaltada1' : 'filaResaltada2'}"
                                            styleClass="tabla">
                                    <f:facet name="header">
                                        Equipo de Trabajo de la Idea-Proyecto
                                    </f:facet>
                                    <p:column styleClass="center">
                                        <f:facet name="header">
                                            <h:outputText value="Cuil"/>
                                        </f:facet>
                                        <h:outputText value="#{agentea.agente.cuil}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Nombre y Apellido"/>
                                        </f:facet>
                                        <h:outputText value="#{agentea.agente.apellido}, #{agentea.agente.nombres}"/>
                                    </p:column>
<!--                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Email"/>
                                        </f:facet>
                                        <h:outputText value="{agentea.agente.email}"/>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Profesion"/>
                                        </f:facet>
                                        <h:outputText value="{agentea.agente.profesion}"/>
                                    </p:column>-->
                                    <p:column styleClass="center">
                                        <f:facet name="header">
                                            <h:outputText value="Dedicación" style="font-weight: bold;" title="Ingrese las horas dedicadas al proyecto por semana." />
                                        </f:facet>
                                        <p:cellEditor>
                                            <f:facet name="output">
                                                <h:outputText id="horasdedicacion" value="#{agentea.horasdisponibles} hs/semana" title="Horas que va a dedicar el agente al proyecto por semana." />
                                                <p:tooltip id="toolTipHorasDedicacion" for="horasdedicacion" showEvent="focus" hideEvent="blur" />
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:inputText id="ihorasdisponibles" value="#{agentea.horasdisponibles}" maxlength="2" size="2"  title="Horas que va a dedicar el agente al proyecto por semana." />
                                                <p:tooltip id="toolTipInputHorasDedicacion" for="ihorasdisponibles" showEvent="focus" hideEvent="blur" />
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>

                                    <p:column styleClass="text-align: center" >
                                        <f:facet name="header">
                                            <h:outputText value="Consultor Externo?" style="font-weight: bold;" title="Click e indique si el agente es consultor externo." />
                                        </f:facet>
                                        <p:cellEditor>
                                            <f:facet name="output"> 
                                                <h:selectBooleanCheckbox  id="ssconsultorexterno" value="#{agentea.consultorexterno}" readonly="true" style="width:20px"  /> 
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:selectBooleanCheckbox  id="sconsultorexterno" value="#{agentea.consultorexterno}" style="width:20px">
                                                    <p:ajax update="ssconsultorexterno" />
                                                </p:selectBooleanCheckbox>
                                            </f:facet>    
                                        </p:cellEditor>
                                    </p:column>    

                                    <p:column >
                                        <f:facet name="header">
                                            <h:outputText value="Función en el Proyecto" style="font-weight: bold;" title="Ingrese la función del agente en el proyecto." />
                                        </f:facet>
                                        <p:cellEditor>
                                            <f:facet name="output">
                                                <h:outputLabel id="outputfuncion" value="#{agentea.funcionproyecto}" title="Función a cumplir por el agente en el proyecto." />
                                                <p:tooltip id="toolTipOutputFuncion" for="outputfuncion" showEvent="focus" hideEvent="blur" />
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:inputText id="ifuncion" value="#{agentea.funcionproyecto}" title="Función que va cumplir el agente en el proyecto." />
                                                <p:tooltip id="toolTipInputFuncion" for="ifuncion" showEvent="focus" hideEvent="blur" />
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>   

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="&nbsp;"/>
                                        </f:facet>
                                        <p:commandButton immediate="true" id="cborrara" icon="ui-icon-trash" title="Quitar del Equipo de Trabajo" update="agentesa"  >
                                            <p:collector value="#{agentea}" removeFrom="#{proyectoAgenteController.equipotrabajo}" unique="true"/>
                                        </p:commandButton>
                                    </p:column>
                                </p:dataTable>

                            </div>

                        </p:tab>
                    </p:tabView>

                    <p:separator />
                    <br />
                    <div align="center">
                        <p:commandButton icon="ui-icon-disk" actionListener="#{proyectoController.soloCrear}"  value="Enviar Para Evaluación" update="growlprincipal"/>
                    </div>
                </p:panel>

            </h:form>

            <h:form> 
                <p:growl globalOnly="true" for="growla" id="growla" showDetail="true" sticky="true" />
                <p:dialog id="dagenteeditar" widgetVar="dagenteeditar" modal="true"  header="Editar Responsable Técnico" >

                    <h:panelGrid columns="2">

                        <h:outputLabel value="Apellido" for="apellido" />
                        <h:inputText id="apellido" value="#{agenteController.selected.apellido}" />
                        <h:outputLabel value="Nombres" for="nombres" />
                        <h:inputText id="nombres" value="#{agenteController.selected.nombres}" />
                        <h:outputLabel value="Tipo de Documento" for="tipodocumentoid" />
                        <h:selectOneMenu id="tipodocumentoid" value="#{agenteController.selected.tipodocumentoid}"  >
                            <f:selectItems value="#{tipodocumentoController.itemsAvailableSelectOne}"/>
                        </h:selectOneMenu>
                        <h:outputLabel value="N° de Documento" for="numerodocumento" />
                        <h:inputText id="numerodocumento" value="#{agenteController.selected.numerodocumento}" />
                        <h:outputLabel value="Telefono" for="telefonoa" />
                        <h:inputText id="telefonoa" value="#{agenteController.selected.telefono}" />
                        <h:outputLabel value="Celular" for="celular" />
                        <h:inputText id="celular" value="#{agenteController.selected.celular}" />
                        <h:outputLabel value="Email" for="emaila" />
                        <h:inputText id="emaila" value="#{agenteController.selected.email}" />
                        <h:outputLabel value="Otro Email" for="otroemail" />
                        <h:inputText id="otroemail" value="#{agenteController.selected.otroemail}" />
                        <h:outputLabel value="Profesion" for="profesion" />
                        <h:inputText id="profesion" value="#{agenteController.selected.profesion}" />
                        <h:outputLabel value="Especialidad" for="especialidad" />
                        <h:inputText id="especialidad" value="#{agenteController.selected.especialidad}" />

                        <h:outputLabel value="Domicilio" for="domicilio" />
                        <h:inputText id="domicilio" value="#{agenteController.selected.domicilio}" />
                        <h:outputLabel value="Dependencia" for="dependenciaid" />
                        <h:selectOneMenu id="dependenciaid" value="#{agenteController.selected.dependenciaid}" >
                            <f:selectItems value="#{dependenciaController.itemsAvailableSelectOne}"/>
                        </h:selectOneMenu>

                        <p:commandButton ajax="true" action="#{agenteController.solograbar()}" value="Editar" oncomplete="dagenteeditar.hide()" update=":formprincipal:tabviewTodo:pagente" />


                    </h:panelGrid>
                    <br />

                </p:dialog>
            </h:form>

            <h:form>
                <p:growl globalOnly="true" for="growlc" id="growlc" showDetail="true" sticky="true" />
                <p:dialog id="dcomitentecrear" widgetVar="dcomitentecrear" modal="true"  header="Crear Comitente" >

                    <h:panelGrid columns="2">
                        <h:outputLabel value="Razon Social" for="razonsocial" />
                        <h:inputText id="razonsocial" value="#{comitenteController.selected.razonsocial}" />
                        <h:outputLabel value="CUIT/CUIL" for="cuit" />
                        <h:inputText id="cuit" value="#{comitenteController.selected.cuit}" />
                        <h:outputLabel value="Teléfono" for="telefono" />
                        <h:inputText id="telefono" value="#{comitenteController.selected.telefono}" />
                        <h:outputLabel value="Contacto" for="contacto" />
                        <h:inputText id="contacto" value="#{comitenteController.selected.contacto}" />
                        <h:outputLabel value="Cargo del Contacto" for="cargocontacto" />
                        <h:inputText id="cargocontacto" value="#{comitenteController.selected.cargocontacto}" />

                        <h:outputLabel value="Email" for="email" />
                        <h:inputText id="email" value="#{comitenteController.selected.email}" />
                        <h:outputLabel value="Tipo de Comitente" for="tipocomitenteid" />
                        <h:selectOneMenu id="tipocomitenteid" value="#{comitenteController.selected.tipocomitenteid}" >
                            <f:selectItems value="#{tipocomitenteController.itemsAvailableSelectOne}"/>
                        </h:selectOneMenu>
                        <h:outputLabel value="Sector" for="sectorid" />
                        <h:selectOneMenu id="sectorid" value="#{comitenteController.selected.sectorid}" >
                            <f:selectItems value="#{sectorController.itemsAvailableSelectOne}"/>
                        </h:selectOneMenu>
                    </h:panelGrid>
                    <br />
                    <p:commandButton action="#{comitenteController.soloCrear()}" value="Crear" oncomplete="PF('dcomitentecrear').hide()" update=":formprincipal:tabviewTodo:pcomitente" />
                </p:dialog>


                <p:dialog id="dconvocatoria" widgetVar="dconvocatoria" modal="true"  header="Convocatoria" >

                    <h:panelGrid columns="2">

                        <p:outputLabel value="Convocatoria:" for="convocatoria" />
                        <p:outputLabel id="convocatoria" value="#{convocatoriaController.selected.convocatoria}" title="Convocatoria" />
                        <p:outputLabel value="Descripcion:" for="descripcion" />
                        <p:outputLabel id="descripcion" value="#{convocatoriaController.selected.descripcion}" title="Descripcion" />
                        <p:outputLabel value="Link:" for="link" />
                        <p:outputLabel id="link" value="#{convocatoriaController.selected.link}" title="Link" />
                        <p:outputLabel value="Fechapublicacion:" for="fechapublicacion" />
                        <p:outputLabel id="fechapublicacion" value="#{convocatoriaController.selected.fechapublicacion}" title="Fechapublicacion" >
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
                        </p:outputLabel>
                        <p:outputLabel value="Fechainicio:" for="fechainicio" />
                        <p:outputLabel id="fechainicio" value="#{convocatoriaController.selected.fechainicio}" title="Fechainicio" >
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
                        </p:outputLabel>
                        <p:outputLabel value="Fechacierre:" for="fechacierre" />
                        <p:outputLabel id="fechacierre" value="#{convocatoriaController.selected.fechacierre}" title="Fechacierre" >
                            <f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
                        </p:outputLabel>
                        <p:outputLabel value="Tipoproyectoid:" for="tipoproyectoidc" />
                        <p:outputLabel id="tipoproyectoidc" value="#{convocatoriaController.selected.tipoproyectoid.tipo}" title="Tipoproyectoid" >

                        </p:outputLabel>
                        <p:outputLabel value="Tipofinanciamientoid:" for="tipofinanciamientoidc" />
                        <p:outputLabel id="tipofinanciamientoidc" value="#{convocatoriaController.selected.tipofinanciamientoid.tipofinanciamiento}" title="Tipofinanciamientoid" >
                        </p:outputLabel> 

                        <p:outputLabel value="Organismo:" for="organismo" />
                        <p:outputLabel id="organismo" value="#{convocatoriaController.selected.organismo}" title="Organismo" />

                        <p:outputLabel value="Beneficiario:" for="beneficiario" />
                        <p:outputLabel id="beneficiario" value="#{convocatoriaController.selected.beneficiario}" title="Tipofinanciamientoid" />
                        <p:outputLabel value="Monto Financiamiento:" for="montofinanciamiento" />
                        <p:outputLabel id="montofinanciamiento" value="#{convocatoriaController.selected.montofinanciamiento}" title="MontoFinanciamiento" />




                        <p:outputLabel value="Estado:" for="estado" />
                        <p:outputLabel id="estado" value="#{convocatoriaController.selected.estado}" title="Estado" />



                    </h:panelGrid>
                </p:dialog>

                <p:dialog id="dfinal" widgetVar="dfinal"  modal="true" closable="false"  header="Alta Idea-Proyecto Creada" >
                    Felicitaciones la Alta Idea Proyecto fue creada Satisfactoriamente!!!
                    <div align="center" >
                        <h:panelGrid columns="2">
                            <p:commandButton value="Imprimir" actionListener="#{proyectoController.pdfIdeaProyecto()}" ajax="false"  />
                            <p:commandButton value="OK" ajax="false" action="List" oncomplete="#{proyectoController.reiniciarValoresSolicitud}" onclick="PF('dfinal').hide();" />
                        </h:panelGrid>
                    </div>

                </p:dialog>
            </h:form>

            <h:form id="formDetallesComitente"> 
                <p:dialog id="detallesComitente" widgetVar="detallesComitente" modal="true"  header="Detalles Comitente" >
                    <p:panelGrid columns="2" styleClass="sinBordes sinFondo">
                        <p:outputLabel value="Razon Social" for="razonsocial" style="font-weight: bold;"/>
                        <p:outputLabel id="razonsocial" value="#{proyectoController.selected.comitenteid.razonsocial}" />
                        <p:outputLabel value="CUIT/CUIL" for="cuit" style="font-weight: bold;" />
                        <p:outputLabel id="cuit" value="#{proyectoController.selected.comitenteid.cuit}" />
                        <p:outputLabel value="Teléfono" for="telefono" style="font-weight: bold;" />
                        <p:outputLabel id="telefono" value="#{proyectoController.selected.comitenteid.telefono}" />
                        <p:outputLabel value="Contacto" for="contacto" style="font-weight: bold;"/>
                        <p:outputLabel id="contacto" value="#{proyectoController.selected.comitenteid.contacto}" />
                        <p:outputLabel value="Cargo del Contacto" for="cargocontacto" style="font-weight: bold;"/>
                        <p:outputLabel id="cargocontacto" value="#{proyectoController.selected.comitenteid.cargocontacto}" />
                        <p:outputLabel value="Email" for="email" style="font-weight: bold;"/>
                        <p:outputLabel id="email" value="#{proyectoController.selected.comitenteid.email}" />
                        <p:outputLabel value="Tipo de Comitente" for="tipo" style="font-weight: bold;"/>
                        <p:outputLabel id="tipo" value="#{proyectoController.selected.comitenteid.tipocomitenteid.tipocomitente}" />
                        <p:outputLabel value="Sector" for="sectorid" style="font-weight: bold;"/>
                        <p:outputLabel id="sectorid" value="#{proyectoController.selected.comitenteid.sectorid.sector}" />
                    </p:panelGrid>
                </p:dialog>
            </h:form>

            <h:form id="formresgistrar">
                <p:dialog id="dialogoregistrar" maximizable="false" 
                          minimizable="false"  header="Registrar Persona" closable="true"
                          resizable="false" widgetVar="dregistrar" >

                    <p:remoteCommand name="rc" update="msgs" actionListener="#{agenteViewController.registrar}" />

                    <p:growl id="msgs" showDetail="true" />
                    <h:panelGrid id="panel" columns="3">
                        <h:outputLabel value="Apellido" for="apellido" />
                        <h:inputText maxlength="30" id="apellido" value="#{agenteViewController.agente1.apellido}" title="Apellido" required="true" />
                        <p:message for="apellido" /> 
                        <h:outputLabel value="Nombres" for="nombres" />
                        <h:inputText maxlength="45" id="nombres" value="#{agenteViewController.agente1.nombres}" title="Nombres" required="true" />
                        <p:message for="nombres" /> 
                        <p:outputLabel value="Tipo de Documento" for="tipodocumentoid" />
                        <h:selectOneMenu id="tipodocumentoid" value="#{agenteViewController.agente1.tipodocumentoid}" title="Tipo de Documento" required="true" >
                            <f:selectItems value="#{tipodocumentoController.itemsAvailableSelectOne}"/>
                        </h:selectOneMenu>
                        <p:message for="tipodocumentoid" /> 
                        <h:outputLabel value="N° de Documento" for="numerodocumento" />
                        <h:inputText id="numerodocumento" value="#{agenteViewController.agente1.numerodocumento}" title="Numero de Documento" required="true" />
                        <p:message for="numerodocumento" />
                        <h:outputLabel value="Cuil" for="cuil" />
                        <p:inputMask id="cuil" value="#{agenteViewController.agente1.cuil}" mask="99-99999999-9"/>
                        <p:message for="cuil" />             
                        <h:outputLabel value="Teléfono" for="telefono" />
                        <h:inputText id="telefono" value="#{agenteViewController.agente1.telefono}" title="Telefono" required="true" />
                        <p:message for="telefono" /> 
                        <h:outputLabel value="Celular" for="celular" />
                        <h:inputText id="celular" value="#{agenteViewController.agente1.celular}" title="Celular" required="false" />
                        <p:message for="celular" /> 
                        <h:outputLabel value="Email" for="email" />
                        <h:inputText id="email" value="#{agenteViewController.agente1.email}" validatorMessage="Email Incorrecto" required="true" >
                            <f:validateRegex pattern="[\w\.-]*[a-zA-Z0-9_]@[\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]" />
                        </h:inputText>
                        <p:message for="email" /> 
                        <h:outputLabel value="Otro Email" for="otroemail" />

                        <h:inputText id="otroemail" value="#{agenteViewController.agente1.otroemail}" >
                            <!--   <f:validateRegex pattern="[\w\.-]*[a-zA-Z0-9_]@[\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]" /> -->
                        </h:inputText>   
                        <p:message for="otroemail" /> 

                        <h:outputLabel value="Domicilio" for="domicilio" />
                        <h:inputText maxlength="200"  id="domicilio" value="#{agenteViewController.agente1.domicilio}" title="Domicilio" required="true" />
                        <p:message for="domicilio" />
                        <h:outputLabel value="Profesion" for="profesion" />
                        <h:inputText maxlength="70" id="profesion" value="#{agenteViewController.agente1.profesion}" title="Profesion" required="true" />
                        <p:message for="profesion" /> 
                        <h:outputLabel value="Especialidad" for="especialidad" />
                        <h:inputText maxlength="70" id="especialidad" value="#{agenteViewController.agente1.especialidad}" title="Especialidad" required="true" />
                        <p:message for="especialidad" /> 

                        <p:commandButton onclick="rc()" oncomplete="PF('dregistrar').hide()" update=":formprincipal:tabviewTodo:agentesa :formprincipal:tabviewTodo:advancedfiltroa" value="Crear" />
                        <br />

                    </h:panelGrid>

                </p:dialog>

            </h:form>

        </ui:define>
    </ui:composition>

</html>
