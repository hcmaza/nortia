<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <div class="Container100">
            <div class="ContainerIndent">
                <script type="text/javascript" src="#{request.contextPath}/resources/js/highcharts.js"></script>
                <script type="text/javascript" src="#{request.contextPath}/resources/js/highcharts-more.js"></script>
                <script type="text/javascript" src="#{request.contextPath}/resources/js/exporting.js"></script>

                <f:event type="preRenderView" listener="#{presupuestoController.findProyecto(proyectoController.selected.id)}"/>
                <f:event type="preRenderView" listener="#{presupuestoController.sumarGastosView()}"/>

                <h:form id="form">

                    <p:tooltip/>

<!--                    <p:commandButton value="Idea Proyecto - Resumen" icon="fa fa-stack-exchange"
                                     styleClass="Fright OrangeButton FloatNoneOnMobile"
                                     actionListener="# {proyectoController.mostrarDialogIdeaProyecto()}"/>-->


                    <div class="Card ">
                        <div class="ui-fluid">
                            <div class="CardTopic">
                                <i class="icon-list Fs50 Fleft MarRight10"></i>

                                <div class="EmptyBox10 ShowOnMobile"></div>
                                Proyecto N° #{proyectoController.selected.id} <br/>
                                <span class="CardSubTopic Fs16"> #{proyectoController.selected.nombre} </span>

                                <div class="SeparatorFull"></div>

                                <p:tabView id="tabview1">

                                    <p:tab id="panelequipo" title="Equipo de Trabajo">

                                        <p:panelGrid columns="3" layout="grid" columnClasses="ui-grid-col-4 PaddingArribaAbajo15px, ui-grid-col-6 PaddingArribaAbajo15px, ui-grid-col-2 PaddingArribaAbajo15px" styleClass="ui-panelgrid-blank">
                                            <div class="CardTopic">
                                                <i class="icon-user Fs30 Fleft MarRight10"></i>
                                                <div class="EmptyBox10 ShowOnMobile"></div>
                                                Agregar Personas al Equipo  <br/>
                                                <span class="CardSubTopic"> Seleccionar docentes-investigadores del equipo. </span>
                                            </div>

                                            <p:selectOneMenu id="advancedfiltroa"
                                                             value="#{agenteViewController.selected}" filter="true"
                                                             filterMatchMode="contains">
                                                <p:ajax update="agregaraequipo"/>
                                                <f:selectItems value="#{agenteViewController.itemsAvailableSelectOne}"/>
                                            </p:selectOneMenu>

                                            <h:panelGrid columns="2" id="agenteselecciona" styleClass="Fright">
                                                <p:commandButton
                                                        title="Agregar al Equipo de Trabajo de la Idea-Proyecto"
                                                        icon="fa fa-plus" id="agregaraequipo" immediate="true"
                                                        update="agentesa"
                                                        action="#{proyectoAgenteController.agregarEquipo}"
                                                        disabled="${empty agenteViewController.selected.apellido ? 'true' : 'false'}" styleClass="GreenButton White" />

                                                <p:commandButton title="Nueva Persona" icon="fa fa-user-plus" onclick="PF('dregistrar').show();" styleClass="OrangeButton White"/>
                                            </h:panelGrid>
                                        </p:panelGrid>

                                        <div align="center">
                                            <p:dataTable id="agentesa" value="#{proyectoAgenteController.equipotrabajo}"
                                                         var="agentea" editable="true" editMode="cell"
                                                         rowIndexVar="indice"
                                                         styleClass="tabla TablaColorEncabezado tablaAjustada">
                                                <p:column styleClass="TexAlCenter">
                                                    <f:facet name="header">
                                                        <h:outputText value="Cuil"/>
                                                    </f:facet>
                                                    <h:outputText value="#{agentea.agente.cuil}"/>
                                                </p:column>
                                                <p:column styleClass="TexAlCenter">
                                                    <f:facet name="header">
                                                        <h:outputText value="Nombre y Apellido"/>
                                                    </f:facet>
                                                    <h:outputText
                                                            value="#{agentea.agente.apellido}, #{agentea.agente.nombres}"/>
                                                </p:column>

                                                <p:column styleClass="TexAlCenter">
                                                    <f:facet name="header">
                                                        <h:outputText value="Función en el Proyecto"
                                                                      style="font-weight: bold;"
                                                                      title="Ingrese la función del agente en el proyecto."/>
                                                    </f:facet>
                                                    <p:cellEditor>
                                                        <f:facet name="output">
                                                            <!--<h:outputLabel id="outputfuncion" value="# {agentea.funcionproyecto}" title="Función a cumplir por el agente en el proyecto." />-->
                                                            <p:inputText id="outputfuncion"
                                                                         value="#{agentea.funcionproyecto}"
                                                                         title="Función que va cumplir el agente en el proyecto."/>
                                                            <p:tooltip id="toolTipOutputFuncion" for="outputfuncion"
                                                                       showEvent="focus" hideEvent="blur"/>
                                                        </f:facet>
                                                        <f:facet name="input">
                                                            <p:inputText id="ifuncion"
                                                                         value="#{agentea.funcionproyecto}"
                                                                         title="Función que va cumplir el agente en el proyecto."/>
                                                            <p:tooltip id="toolTipInputFuncion" for="ifuncion"
                                                                       showEvent="focus" hideEvent="blur"/>
                                                        </f:facet>
                                                    </p:cellEditor>
                                                </p:column>


                                                <p:column styleClass="TexAlCenter" style="vertical-align: middle;">
                                                    <f:facet name="header">
                                                        <h:outputText value="Participación" style="font-weight: bold;"
                                                                      title="Click e indique si el agente es consultor externo."/>
                                                    </f:facet>
                                                    <p:cellEditor>
                                                        <f:facet name="output">
                                                            <p:selectBooleanCheckbox id="ssconsultorexterno"
                                                                                     value="#{agentea.consultorexterno}"
                                                                                     style="width:20px; "/>
                                                            <h:outputLabel id="labelConsultorexterno"
                                                                           value="#{agentea.consultorexterno eq 'TRUE' ? ' Consultor ':' Docente '}"
                                                                           styleClass="Fs16" />
                                                        </f:facet>
                                                        <f:facet name="input">
                                                            <!--                                                            <p:selectBooleanButton onLabel="Consultor" offLabel="Docente" id="sconsultorexterno" value="# {agentea.consultorexterno}"  >
                                                                                                                                <p:ajax update="@this :formprincipal:tabviewTodo:agentesa"  />
                                                                                                                            </p:selectBooleanButton>-->
                                                            <p:selectBooleanCheckbox id="sconsultorexterno"
                                                                                     value="#{agentea.consultorexterno}"
                                                                                     style="width:20px; ">
                                                                <p:ajax update="ssconsultorexterno labelConsultorexterno labelConsultorexterno2 ihorasdisponibles horasdedicacion"
                                                                        oncomplete="$(function(){PrimeFaces.focus(':formprincipal:tabviewTodo:horasdedicacion');});"/>
                                                            </p:selectBooleanCheckbox>
                                                            <p:outputLabel id="labelConsultorexterno2"
                                                                           value="#{agentea.consultorexterno eq 'TRUE' ? ' Consultor ':' Docente '}" styleClass="Fs16 DispBlock Fright" style="padding-top: 2px;"
                                                                           />
                                                        </f:facet>
                                                    </p:cellEditor>
                                                </p:column>
                                                <p:column styleClass="TexAlCenter">
                                                    <f:facet name="header">
                                                        <h:outputText value="Dedicación [hs/semana]"
                                                                      style="font-weight: bold;"
                                                                      title="Ingrese las horas dedicadas al proyecto por semana."/>
                                                    </f:facet>
                                                    <p:cellEditor>
                                                        <f:facet name="output">
                                                            <!--<h:outputText id="horasdedicacion" value="# {agentea.horasdisponibles}" title="Horas que va a dedicar el agente al proyecto por semana." />-->
                                                            <p:inputText id="horasdedicacion"
                                                                         value="#{agentea.horasdisponibles}"
                                                                         disabled="#{agentea.consultorexterno eq 'TRUE'}"
                                                                         maxlength="2" size="2"
                                                                         title="Horas que va a dedicar el agente al proyecto por semana."/>
                                                            <p:tooltip id="toolTipHorasDedicacion" for="horasdedicacion"
                                                                       showEvent="focus" hideEvent="blur"/>
                                                        </f:facet>
                                                        <f:facet name="input">
                                                            <p:inputText id="ihorasdisponibles"
                                                                         value="#{agentea.horasdisponibles}"
                                                                         disabled="#{agentea.consultorexterno eq 'TRUE'}"
                                                                         maxlength="2" size="2"
                                                                         title="Horas que va a dedicar el agente al proyecto por semana."/>
                                                            <p:tooltip id="toolTipInputHorasDedicacion"
                                                                       for="ihorasdisponibles" showEvent="focus"
                                                                       hideEvent="blur"/>
                                                        </f:facet>
                                                    </p:cellEditor>
                                                </p:column>
                                                <p:column styleClass="TexAlCenter">
                                                    <f:facet name="header">
                                                        <h:outputText value="Honorario * mes" style="font-weight: bold;"
                                                                      title="Ingrese el monto a cobrar por mes en concepto de honorarios."/>
                                                    </f:facet>
                                                    <p:cellEditor>
                                                        <f:facet name="output">

                                                            <p:inputText id="honorario" value="#{agentea.honorario}"
                                                                         disabled="#{agentea.consultorexterno eq 'FALSE'}"
                                                                         maxlength="8" size="8"
                                                                         title="Honorario que el Consultor Externo cobra"/>
                                                            <p:tooltip id="toolTipHonorario" for="honorario"
                                                                       showEvent="focus" hideEvent="blur"/>
                                                        </f:facet>
                                                        <f:facet name="input">
                                                            <p:inputText id="ihonorario" value="#{agentea.honorario}"
                                                                         disabled="#{agentea.consultorexterno eq 'FALSE'}"
                                                                         maxlength="8" size="8"
                                                                         title="Honorario que el Consultor Externo cobra"/>
                                                            <p:tooltip id="toolTipInputHonorario" for="ihonorario"
                                                                       showEvent="focus" hideEvent="blur"/>
                                                        </f:facet>
                                                    </p:cellEditor>
                                                </p:column>


                                                <p:column>
                                                    <f:facet name="header">
                                                        <h:outputText value="&nbsp;"/>
                                                    </f:facet>
                                                    <p:commandButton immediate="true" id="cborrardeequipo" icon="fa fa-user-times"
                                                                     title="Quitar del Equipo de Trabajo"
                                                                     update="agentesa" styleClass="RedButton White">
                                                        <p:collector value="#{agentea}"
                                                                     removeFrom="#{proyectoAgenteController.equipotrabajo}"
                                                                     unique="true"/>
                                                    </p:commandButton>
                                                </p:column>
                                            </p:dataTable>

                                        </div>


                                    </p:tab>

                                    <p:tab id="paneletapas" title="Plan de Trabajo">
                                        <p:panelGrid columns="2" layout="grid" columnClasses="ui-grid-col-10 PaddingArribaAbajo15px, ui-grid-col-2 PaddingArribaAbajo15px" styleClass="ui-panelgrid-blank" >

                                            <div class="CardTopic">
                                                <i class="fa fa-tasks Fs30 Fleft MarRight10 Blue"></i>
                                                <div class="EmptyBox10 ShowOnMobile"></div>
                                                Agregar Etapas y Tareas al Plan  <br/>
                                                <span class="CardSubTopic"> Especificar las etapas, tareas y los recursos a utilizar en cada una de ellas. </span>
                                            </div>

                                            <p:commandButton id="btn_addetapa" alt="Agregar Etapa"
                                                             update=":forme:etapa :forme:resultadoesperado :forme:tareasdeproyecto"
                                                             icon="fa fa-plus"
                                                             styleClass="GreenButton White Fright"
                                                             action="#{etapaController.rearmarEtapasProyecto}"
                                                             onclick="PF('dialogoetapa').show();" immediate="true"
                                                             style="margin-bottom: 5px; " title="Agregar Etapa al Proyecto" />
                                        </p:panelGrid>

                                        <p:tooltip for="btn_addetapa" />

                                        <p:treeTable id="treetableetapas" value="#{etapaController.root}" emptyMessage="No hay etapas agregadas al proyecto."
                                                     var="document" styleClass="tablaArbol tablaAjustada tabla TablaColorEncabezado">

                                            <p:column headerText="Etapa/Tarea">
                                                <h:outputText value="#{document.tarea}"/>
                                            </p:column>
                                            <p:column headerText="Fecha Inicio">
                                                <h:outputText value="#{document.fechainicio}">
                                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Fecha Fin">
                                                <h:outputText value="#{document.fechafin}">
                                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Dias">
                                                <h:outputText value="#{document.dias}">

                                                </h:outputText>
                                            </p:column>
                                            <p:column headerText="Equipo">

                                                <ui:repeat value="#{document.tareaAgenteList}" var="ta">
                                                    <p:outputLabel
                                                            value="#{ta.agenteid.apellido},#{ta.agenteid.nombres} (#{ta.funcion})"/>
                                                    <br/>

                                                </ui:repeat>
                                            </p:column>
                                            <p:column>
                                                <p:commandButton title="Editar" rendered="#{document.estado eq null}"
                                                                 onclick="PF('dialogoetapa').show()"
                                                                 update=":forme:etapa :forme:tareasdeproyecto :forme:cetapa "
                                                                 action="#{etapaController.prepararEditarEtapaTreeTable(document)}"
                                                                 icon="fa fa-search" immediate="true" styleClass="OrangeButton White"
                                                                 />

                                                <p:commandButton title="Eliminar"
                                                                 update=":form:tabview1:treetableetapas :form:tabview1:contenedor :form:beanvalue"
                                                                 rendered="#{document.estado eq null}"
                                                                 onclick="crearGrafico();"
                                                                 actionListener="#{etapaController.eliminarEtapaTreeTable(document)}"
                                                                 icon="fa fa-trash" styleClass="RedButton White"/>
                                            </p:column>

                                        </p:treeTable>

                                        <div class="Separator" />

                                        <div class="CardTopic">
                                            <i class="icon-calendar Fs30 Fleft MarRight10"></i>
                                            <div class="EmptyBox10 ShowOnMobile"></div>
                                            Diagrama de Gantt  <br/>
                                            <span class="CardSubTopic"> Muestra gráficamente la distribución de tiempos de las etapas y tareas. </span>
                                        </div>

                                        <p:outputPanel id="contenedor" >
                                            <div id="containergrafico" >

                                            </div>
                                        </p:outputPanel>

                                        <div class="Separator" />

                                        <h:commandLink>
                                            <p:graphicImage value="/resources/img/excel.png"/>
                                            <p:dataExporter type="xls" target="tareasdeproyecto" fileName="tareas"/>
                                        </h:commandLink>

                                        <h:commandLink>
                                            <p:graphicImage value="/resources/img/pdf.png"/>
                                            <p:dataExporter type="pdf" target="tareasdeproyecto" fileName="tareas"/>
                                        </h:commandLink>

                                        <h:commandLink>
                                            <p:graphicImage value="/resources/img/csv.png"/>
                                            <p:dataExporter type="csv" target="tareasdeproyecto" fileName="tareas"/>
                                        </h:commandLink>

                                        <h:commandLink>
                                            <p:graphicImage value="/resources/img/xml.png"/>
                                            <p:dataExporter type="xml" target="tareasdeproyecto" fileName="tareas"/>
                                        </h:commandLink>

                                    </p:tab>

                                    <p:tab title="Presupuesto">

                                        <p:treeTable id="tablepresupuesto" value="#{presupuestoTareaController.root}"
                                                     var="item"
                                                     styleClass="tablaArbol tablaAjustada tabla TablaColorEncabezado" emptyMessage="No hay items en el presupuesto." >

                                            <p:column headerText="Etapa" >
                                                <h:outputText value="#{item.descripcion}"/>
                                            </p:column>
                                            <p:column headerText="Rubro" >
                                                <h:outputText value="#{item.rubro.rubro}"/>
                                            </p:column >
                                            <p:column headerText="Costo Unitario" styleClass="TexAlRight">
                                                <h:outputText value="$ #{item.costounitario}"/>
                                            </p:column>
                                            <p:column headerText="Cantidad" styleClass="TexAlRight">
                                                <h:outputText value="#{item.cantidad}"/>
                                            </p:column>
                                            <p:column headerText="Aporte Comitente" styleClass="TexAlRight">
                                                <h:outputText value="$ #{item.aportecomitente}"/>
                                            </p:column>
                                            <p:column headerText="Aporte Universidad" styleClass="TexAlRight">
                                                <h:outputText value="$ #{item.aporteuniversidad}"/>
                                            </p:column>
                                            <p:column headerText="Aporte Organismo" styleClass="TexAlRight">
                                                <h:outputText value="$ #{item.aporteorganismo}"/>
                                            </p:column>
                                            <p:column headerText="Total" styleClass="TexAlRight">
                                                <h:outputText value="$ #{item.total}"/>
                                            </p:column>
                                            <p:columnGroup type="footer">
                                                <p:row>
                                                    <p:column colspan="4" footerText="Totales:" styleClass="Gris3Back White Fs16 FontBold TexAlRight"/>
                                                    <p:column footerText="$ #{presupuestoTareaController.sumagastocomitente}" styleClass="VerdePlantaBack White Fs16 FontBold TexAlRight" />
                                                    <p:column footerText="$ #{presupuestoTareaController.sumagastouniversidad}" styleClass="VerdePlantaBack White Fs16 FontBold TexAlRight" />
                                                    <p:column footerText="$ #{presupuestoTareaController.sumagastoorganismo}" styleClass="VerdePlantaBack White Fs16 FontBold TexAlRight" />
                                                    <p:column footerText="$ #{presupuestoTareaController.sumatotal}" styleClass="CelesteBack White Fs16 FontBold TexAlRight" />
                                                </p:row>
                                            </p:columnGroup>
                                        </p:treeTable>

                                        <div align="center">
                                            <h:panelGrid id="pchartpresupuesto" columns="2" styleClass="left,right">
                                                <p:chart type="pie" id="chartaportes" model="#{presupuestoTareaController.pieModelAportes}" style="width:15%;height:300px"/>
                                                <p:chart type="pie" id="chartrubros" model="#{presupuestoTareaController.pieModelRubros}" style="width:15%;height:300px"/>
                                            </h:panelGrid>
                                        </div>
                                    </p:tab>

                                    <p:tab title="Documentación">

                                        <p:fieldset legend="Archivos">
                                            <h:panelGrid cellpadding="2" cellspacing="10" columnClasses="right,left"
                                                         columns="3">

                                                <h:form id="fupload" enctype="multipart/form-data">
                                                    <p:fileUpload label="Documentacion para subir" id="documentacion"
                                                                  fileUploadListener="#{archivoproyectoController.handleFileUpload}"
                                                                  mode="advanced"
                                                                  sizeLimit="10000000" multiple="true" auto="true"
                                                                  allowTypes="/(\.|\/)(gif|jpe?g|png|doc|docx|pdf)$/"
                                                                  update=":form:tabview1:tdocumentacionnombre1">

                                                    </p:fileUpload>
                                                </h:form>

                                                <p:dataTable id="tdocumentacionnombre1" var="arc"
                                                             value="#{archivoproyectoController.collectorArchivoProyecto}"
                                                             rowIndexVar="indice"
                                                             styleClass="tabla tablaAjustada TablaColorEncabezado">
                                                    <p:column headerText="Archivos">
                                                        <h:outputText value="#{arc.nombre}"/>
                                                    </p:column>
                                                    <p:column headerText="">
                                                        <p:commandLink rendered="#{arc.proyectoid.id ==null}"
                                                                       immediate="true" value="Eliminar"
                                                                       action="#{archivoproyectoController.removerArchivoCollection}"
                                                                       update=":form:tabview1:tdocumentacionnombre1">
                                                            <f:setPropertyActionListener value="#{arc}"
                                                                                         target="#{archivoproyectoController.selected}"/>
                                                        </p:commandLink>
                                                    </p:column>
                                                </p:dataTable>

                                            </h:panelGrid>
                                        </p:fieldset>

                                    </p:tab>
                                </p:tabView>
                            </div>
                        </div>
                    </div>

                    <p:separator />

                    <div align="center">
                        <p:commandButton value="Enviar para evaluacion" actionListener="#{proyectoController.enviarEvaluarProyecto}" icon="fa fa-check" styleClass="GreenButton White" />
                    </div>

                    <h:inputHidden value="#{etapaController.gsoncategoria}" id="beanvalue"/>

                </h:form>

                <!-- **************************************************************

                     ******************** DIALOGO NUEVA TAREA *********************

                     ************************************************************** -->

                <!--onShow="PF('wizardtarea').select(0);"-->

                <h:form id="formd">

                    <p:dialog id="dtarea" widgetVar="dtarea" closable="true" showHeader="true"
                              resizable="false" responsive="true"
                              showEffect="clip" hideEffect="fold" modal="true">

                        <f:facet name="header">
                            <div class="CardTopic">
                                <i class="icon-task Fs30 Fleft MarRight10"></i>
                                <div class="EmptyBox10 ShowOnMobile"></div>
                                <h:outputText value="Nueva Tarea en Etapa: #{etapaController.selected.etapa}" styleClass="Fs25 FontBold Blue Fright MarTop5"  />
                            </div>
                        </f:facet>

                        <p:tabView id="wizardtarea" activeIndex="0" widgetVar="wizardtarea" styleClass="Container" onTabChange="return PF('wizardtarea').onTabChange(index)" >
                            <!--binding="# {tareaController.nuevaTareaTab}" dynamic="true" cache="false"-->
                            <!--<p:ajax event="tabChange" listener="# {tareaController.onNuevaTareaTabChange}"  />-->

                            <p:tab id="tab1" title="Tarea" >

                                <p:outputLabel value="Título de la Tarea:" for="tarea" styleClass="Blue FontBold PaddingTopPercent10 "/> <br />
                                <p:inputText size="100" required="true" id="tarea" value="#{tareaController.selected.tarea}" title="Tarea" styleClass="MargenArriba5pxAbajo10px" /> <br />

                                <p:outputLabel value="Descripcion:" for="descripciontarea" styleClass="Blue FontBold PaddingTopPercent10" /> <br />
                                <p:inputTextarea cols="100" rows="3" id="descripciontarea" value="#{tareaController.selected.descripcion}" title="Descripcion" styleClass="MargenArriba5pxAbajo10px"/> <br />

                                <p:outputLabel value="Información" styleClass="Blue FontBold MarBot10"  /> <br />

                                <div class="Container100">
                                    <p:panelGrid styleClass="Container100 ui-panelgrid-blank" >
                                        <p:row>
                                            <p:column>
                                                <p:outputLabel value="Fecha de Inicio:" for="fechainicio" styleClass="FontBold" />
                                            </p:column>
                                            <p:column styleClass="center">
                                                <p:calendar size="11" required="true" id="fechainicio" showOn="button"
                                                            value="#{tareaController.selected.fechainicio}"
                                                            title="Fechainicio">
                                                    <p:ajax event="dateSelect" update=":formd:wizardtarea:dfechafin"/>
                                                </p:calendar>
                                            </p:column>
                                            <p:column>
                                                <p:outputLabel style="font-weight: bold" value="Dias:" for="dias"/>
                                            </p:column>
                                            <p:column styleClass="center">
                                                <p:spinner size="5" min="1" required="true" id="dias"
                                                           value="#{tareaController.selected.dias}" title="Dias">
                                                    <p:ajax event="change" listener="#{tareaController.sumarDias}"
                                                            update=":formd:wizardtarea:dfechafin" process="@this"/>
                                                    <p:ajax event="keyup" listener="#{tareaController.sumarDias}"
                                                            update=":formd:wizardtarea:dfechafin" process="@this"/>
                                                </p:spinner>
                                            </p:column>
                                            <p:column>
                                                <p:outputLabel style="font-weight: bold" value="Fecha Fin:" for="dfechafin"/>
                                            </p:column>
                                            <p:column styleClass="center">
                                                <p:calendar size="11" id="dfechafin" required="true" showOn="button"
                                                            value="#{tareaController.selected.fechafin}" title="Fechafin"
                                                            requiredMessage="Se debe establecer una fecha de fin para la tarea."  >
                                                    <p:ajax event="dateSelect" listener="#{tareaController.calcularDiferenciaDias}" update=":formd:wizardtarea:dias" />
                                                </p:calendar>
                                            </p:column>
                                        </p:row>
                                        <p:row>
                                            <p:column>
                                                <p:outputLabel style="font-weight: bold" value="Prioridad:" for="prioridad"/>
                                            </p:column>
                                            <p:column styleClass="center">
                                                <p:selectOneMenu id="prioridad"
                                                                 value="#{tareaController.selected.prioridad}">
                                                    <p:ajax update="@this"/>
                                                    <f:selectItem itemLabel="Alta" itemValue="Alta"/>
                                                    <f:selectItem itemLabel="Media" itemValue="Media"/>
                                                    <f:selectItem itemLabel="Baja" itemValue="Baja"/>
                                                </p:selectOneMenu>
                                            </p:column>
                                            <p:column>
                                                <p:outputLabel style="font-weight: bold" value="Avance:"/>
                                            </p:column>
                                            <p:column colspan="2">
                                                <p:slider minValue="0" maxValue="100" for="iavance"/>
                                            </p:column>
                                            <p:column styleClass="center">
                                                <p:inputText size="8" id="iavance"
                                                             value="#{tareaController.selected.avance}" title="Avance"/>
                                                <p:outputLabel style="font-weight: bold" value="%"/>
                                            </p:column>
                                        </p:row>
                                    </p:panelGrid>
                                </div>
                            </p:tab>

                            <p:tab id="tab2" title="Equipo de trabajo">

                                <p:panelGrid columns="3" layout="grid" styleClass="ui-grid-col-12, ui-panelgrid-blank" columnClasses="ui-grid-col-4 MarTop10, ui-grid-col-7, ui-grid-col-1">

                                    <p:outputLabel value="Agregar Personas a Tarea"  styleClass="Blue FontBold Fs14" for="advancedfiltro" />
                                    <p:selectOneMenu id="advancedfiltro" value="#{agenteViewController.selected}" filter="true" filterMatchMode="contains" styleClass="ui-grid-col-12">
                                        <p:ajax update="@this, botonAgregarPersonaTarea "/>
                                        <f:selectItems value="#{agenteViewController.itemsAvailableSelectOneProyectoAgente}"/>
                                    </p:selectOneMenu>
                                    <p:commandButton id="botonAgregarPersonaTarea" onclick="PF('dialogotareaagentepresupuesto').show()"
                                                     title="Agregar Persona a la Tarea"
                                                     update=":formd:paneltareaagentepresupuesto"
                                                     actionListener="#{tareaAgenteController.armarTareaAgentePresupuesto()}"
                                                     disabled="${empty agenteViewController.selected.apellido ? 'true' : 'false'}"
                                                     icon="fa fa-plus" styleClass="GreenButton White">
                                    </p:commandButton>
                                </p:panelGrid>

                                <p:tooltip for="botonAgregarPersonaTarea" />

                                <p:dataTable id="tagentes" value="#{tareaAgenteController.tareasagentes}"
                                             var="tareaagente"
                                             editable="true" editMode="cell"
                                             rowIndexVar="indice"
                                             styleClass="tabla tablaAjustada TablaColorEncabezado" emptyMessage="No se agregaron personas a la tarea." >

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="CUIL"/>
                                        </f:facet>
                                        <h:outputText value="#{tareaagente.agenteid.cuil}"/>
                                    </p:column>
                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="Nombre y Apellido"/>
                                        </f:facet>
                                        <h:outputText value="#{tareaagente.agenteid.apellido}, #{tareaagente.agenteid.nombres}"/>
                                    </p:column>
                                    <p:column headerText="Función">
                                        <h:outputText value="#{tareaagente.funcion}"/>
                                    </p:column>
                                    <p:column headerText="Dedicación" styleClass="TexAlCenter">
                                        <h:outputText value="#{tareaagente.horasdedicadas eq null ? 'No aplicable':tareaagente.horasdedicadas}"/>
                                    </p:column>
                                    <p:column headerText="Honorarios/Mes" styleClass="TexAlRight" >
                                        <h:outputText value="#{tareaagente.horasdedicadas eq null ? 'No aplicable': tareaagente.horasdedicadas * tareaagente.costoUnitarioCargoLegajo().floatValue()}">
                                            <f:convertNumber minFractionDigits="2" />
                                        </h:outputText>
                                    </p:column>

                                    <p:column>
                                        <f:facet name="header">
                                            <h:outputText value="&nbsp;"/>
                                        </f:facet>

                                        <p:commandButton id="cborrara" immediate="true" icon="fa fa-trash" styleClass="RedButton White"
                                                         title="Eliminar"
                                                         actionListener="#{tareaAgenteController.eliminarTareaAgente(tareaagente)}"
                                                         update="tagentes :formd:wizardtarea:tablepresupuestotarea">
                                        </p:commandButton>
                                        <p:tooltip for="cborrara" />
                                    </p:column>
                                </p:dataTable>
                            </p:tab>

                            <p:tab id="tab3" title="Presupuesto">

                                <p:panelGrid columns="2" layout="grid" styleClass="ui-grid-col-12, ui-panelgrid-blank" columnClasses="ui-grid-col-10 MarTop10 , ui-grid-col-2" >

                                    <p:outputLabel value="Agregar Item al Presupuesto de la Tarea"  styleClass="Blue FontBold Fs16" for="advancedfiltro" />

                                    <p:commandButton id="cagregarpresupuestotarea"
                                                     title="Agregar Presupuesto a la Tarea" actionListener="#{presupuestoTareaController.nuevoCurrent}"
                                                     update=":formd:wizardtarea:tablepresupuestotarea :formpresupuesto:panelpresupuesto" onclick="PF('dialogopresupuesto').show();"
                                                     icon="fa fa-plus" styleClass="GreenButton White Fright"/>
                                </p:panelGrid>

                                <p:tooltip for="cagregarpresupuestotarea" />

                                <p:dataTable id="tablepresupuestotarea"
                                             value="#{presupuestoTareaController.presupuestostareasitems}"
                                             var="item"
                                             rowIndexVar="indice" emptyMessage="No hay items en el presupuesto de la tarea."
                                             styleClass="tabla tablaAjustada TablaColorEncabezado">

                                    <p:column headerText="Descripción">
                                        <h:outputText value="#{item.descripcion}"/>
                                    </p:column>
                                    <p:column headerText="Rubro">
                                        <h:outputText value="#{item.rubro.rubro}"/>
                                    </p:column>
                                    <p:column headerText="Aporte Universidad" styleClass="TexAlRight FontBold">
                                        <h:outputText value="$ #{item.aporteuniversidad}"/>
                                    </p:column>
                                    <p:column headerText="Aporte Organismo" styleClass="TexAlRight FontBold">
                                        <h:outputText value="$ #{item.aporteorganismo}"/>
                                    </p:column>
                                    <p:column headerText="Aporte Comitente" styleClass="TexAlRight FontBold">
                                        <h:outputText value="$ #{item.aportecomitente}"/>
                                    </p:column>
                                    <p:column headerText="Total" styleClass="TexAlRight FontBold">
                                        <h:outputText value="$ #{item.total}"/>
                                    </p:column>
                                    <p:column headerText="">
                                        <p:commandButton
                                                rendered="#{item.rubro.id != 4 and (item.rubro.id != 5) }"
                                                icon="fa fa-trash" title="Eliminar" styleClass="RedButton White"
                                                update=":form:tabview1:tablepresupuesto :formd:wizardtarea:tab3"
                                                action="#{presupuestoTareaController.eliminarPresupuesto(item)}"
                                                />
                                    </p:column>
                                    <p:columnGroup type="footer">
                                        <p:row>
                                            <p:column colspan="2" footerText="Totales:" styleClass="Gris3Back White Fs14 FontBold TexAlRight" style="color: #ffffff !important;" />
                                            <p:column footerText="$ #{presupuestoTareaController.sumaraportesUniversidadEnListaPresupuestoTareaItems()}" styleClass="VerdePlantaBack White Fs14 FontBold TexAlRight" style="color: #ffffff !important;" />
                                            <p:column footerText="$ #{presupuestoTareaController.sumaraportesOrganismoEnListaPresupuestoTareaItems()}" styleClass="VerdePlantaBack White Fs14 FontBold TexAlRight" style="color: #ffffff !important;" />
                                            <p:column footerText="$ #{presupuestoTareaController.sumaraportesComitenteEnListaPresupuestoTareaItems()}" styleClass="VerdePlantaBack White Fs14 FontBold TexAlRight" style="color: #ffffff !important;" />
                                            <p:column footerText="$ #{presupuestoTareaController.sumaraportesTotalesEnListaPresupuestoTareaItems()}" styleClass="CelesteBack White Fs14 FontBold TexAlRight" style="color: #ffffff !important;" />
                                            <p:column footerText=" " styleClass="VerdePlantaBack White Fs14 FontBold TexAlRight" style="color: #ffffff !important;" />

                                        </p:row>
                                    </p:columnGroup>
                                </p:dataTable>

                            </p:tab>

                        </p:tabView>

                        <f:facet name="footer">
                            <div align="center">

                                <p:commandButton id="botontareaok" value="Agregar Tarea a Etapa" oncomplete="PF('dtarea').hide();"
                                                 actionListener="#{tareaController.armarTareasProyecto}" validateClient="true"
                                                 update=":forme:tareasdeproyecto" icon="fa fa-save" styleClass="GreenButton White" />
                            </div>
                        </f:facet>

                    </p:dialog>

                    <!--****************************************************-->
                    <!--************ DIALOGO PRESUPUESTO RRHH **************-->
                    <!--****************************************************-->

                    <p:dialog id="dialogotareaagentepresupuesto" maximizable="false" modal="true" minimizable="false"
                              closable="true" resizable="false" responsive="true" widgetVar="dialogotareaagentepresupuesto">

                        <f:facet name="header">
                            <div class="CardTopic">
                                <i class="fa fa-money Fs30 Fleft MarRight10"></i>
                                <div class="EmptyBox10 ShowOnMobile"></div>
                                <h:outputText value="Integrante de la Tarea: Costos y Aportes" styleClass="Fs25 FontBold Blue Fright MarTop5"  />
                            </div>
                        </f:facet>

                        <p:messages autoUpdate="true" showDetail="true" escape="false" closable="true" />

                        <p:panel id="paneltareaagentepresupuesto" style="border: none;">

                            <p:panelGrid columns="2" layout="grid" columnClasses="ui-grid-col-4, ui-grid-col-8" styleClass="ui-panelgrid-blank" >
                                <p:outputLabel value=" Nombre de Integrante:" for="nombreagenteagentepresupuesto" styleClass=" FontBold"/>
                                <p:outputLabel id="nombreagenteagentepresupuesto" style="font-weight: bold" value="#{agenteViewController.selected.apellido}, #{agenteViewController.selected.nombres}"/>

                                <p:outputLabel value="Funcion en la tarea:" for="funcion" styleClass=" FontBold" style="line-height: 250%;"/>
                                <p:inputText id="funcion" value="#{tareaAgenteController.current2.funcion}" styleClass="ui-grid-col-12"/>

                                <p:outputLabel value="Participación:" for="agenteparticipacion" styleClass="FontBold"/>
                                <p:outputLabel id="agenteparticipacion" style="font-weight: bold"
                                               value="#{ (agenteViewController.buscarProyectoAgentePorAgenteId(agenteViewController.selected.id, proyectoController.selected.id).consultorexterno) ? 'Consultor Externo' : 'Docente' }"/>

                                <p:outputLabel rendered="#{tareaAgenteController.current2.horasdedicadas > -1}" value="Horas/Semana dedicadas:" for="horasdedicadas" styleClass="FontBold" style="line-height: 250%;"/>
                                <p:inputText size="10" rendered="#{tareaAgenteController.current2.horasdedicadas > -1}"
                                             id="horasdedicadas"
                                             value="#{tareaAgenteController.current2.horasdedicadas}"
                                             title="Horas Dedicadas" styleClass="ui-grid-col-12 TexAlRight">
                                    <p:ajax event="keyup" listener="#{tareaAgenteController.onCellEdit()}" update=":formd:agentetotalpresupuesto, :formd:panelAportesRRHH"/>
                                </p:inputText>

                                <p:outputLabel value="Costo unitario:" for="agentecostounitario" styleClass="FontBold"/>
                                <p:outputLabel id="agentecostounitario" value="#{presupuestoTareaController.current2.costounitario}" title="Costounitario">
                                    <f:convertNumber type="currency" currencySymbol="$"  groupingUsed="false" locale="es_AR"/>
                                </p:outputLabel>

                                <p:outputLabel value="Dias en Tarea:" for="agentecantidad" styleClass="FontBold"/>
                                <p:outputLabel id="agentecantidad"
                                               value="#{presupuestoTareaController.current2.cantidad}"
                                               title="Cantidad">
                                    <f:convertNumber type="number" groupingUsed="false" locale="es_AR"/>
                                </p:outputLabel>

                                <p:outputLabel value="Costo Total:" for="agentetotalpresupuesto" styleClass=" FontBold" />
                                <p:outputLabel id="agentetotalpresupuesto" value="$ #{presupuestoTareaController.current2.total}" title="Total" styleClass="FontBold Blue">
                                </p:outputLabel>

                                <p:outputLabel value="Aporte:" for="agenteaporterealizado" styleClass=" FontBold" rendered="#{!tareaAgenteController.agenteEsConsultorExterno()}" />
                                <p:outputLabel id="agenteaporterealizado" value="Realizado por la Universdad" styleClass="FontBold Blue" rendered="#{!tareaAgenteController.agenteEsConsultorExterno()}" />

                            </p:panelGrid>

                            <div class="Separator" />

                            <p:outputPanel id="panelAportesRRHH" rendered="#{tareaAgenteController.agenteEsConsultorExterno()}">
                                <p:panelGrid columns="2" layout="grid" columnClasses="Blue FontBold MarTop10" styleClass="ui-panelgrid-blank" >

                                    <p:outputLabel value="Aporte de la Universidad:" for="agenteaporteuniversidad"/>
                                    <p:inputText id="agenteaporteuniversidad"
                                                 value="#{presupuestoTareaController.current2.aporteuniversidad}"
                                                 title="Aporteuniversidad" styleClass="ui-grid-col-12 TexAlRight">
                                        <f:convertNumber type="number" groupingUsed="false" locale="en"/>
                                        <p:ajax event="keyup" listener="#{presupuestoTareaController.verificarAportes2}"/>
                                    </p:inputText>

                                    <p:outputLabel value="Aporte del Organismo:" for="agenteaporteorganismo"/>
                                    <p:inputText id="agenteaporteorganismo"
                                                 value="#{presupuestoTareaController.current2.aporteorganismo}"
                                                 title="Aporteorganismo" styleClass="ui-grid-col-12 TexAlRight">
                                        <f:convertNumber type="number" groupingUsed="false" locale="en"/>
                                        <p:ajax event="keyup" listener="#{presupuestoTareaController.verificarAportes2}"/>
                                    </p:inputText>

                                    <p:outputLabel value="Aporte del Comitente:" for="agenteaportecomitente"/>
                                    <p:inputText id="agenteaportecomitente"
                                                 value="#{presupuestoTareaController.current2.aportecomitente}"
                                                 title="Aportecomitente" validatorMessage="Ingrese solo números" styleClass="ui-grid-col-12 TexAlRight">
                                        <f:convertNumber type="number" groupingUsed="false" locale="en"/>
                                        <p:ajax event="keyup" listener="#{presupuestoTareaController.verificarAportes2}"/>
                                    </p:inputText>
                                </p:panelGrid>

                                <div class="Separator"   />

                            </p:outputPanel>

                        </p:panel>

                        <div class="center">
                            <p:commandButton id="agregaragentealpresupuesto" value="Agregar Persona"
                                             action="#{tareaAgenteController.agregarEquipo()}"
                                             update=":formpresupuesto:panelpresupuesto :form:tabview1:tablepresupuesto :form:tabview1:pchartpresupuesto :form:tabview1:chartaportes :form:tabview1:chartrubros :formd:wizardtarea:tablepresupuestotarea :formd:wizardtarea:tagentes "
                                             oncomplete="handleTareaAgentePresupuestoRequest(xhr, status, args)" styleClass="GreenButton White" icon="fa fa-save" />
                        </div>

                    </p:dialog>

                </h:form>

                <!--
                    *******************************************************
                                DIALOGO ETAPA
                    *******************************************************
                -->

                <h:form id="forme">
                    <p:dialog id="dialogoetapa" widgetVar="dialogoetapa"
                              maximizable="false" minimizable="false" showHeader="true"
                              closable="true" closeOnEscape="true"
                              resizable="false" modal="true" responsive="true" >

                        <f:facet name="header">
                            <div class="CardTopic">
                                <i class="icon-calendar Fs30 Fleft MarRight10"></i>
                                <div class="EmptyBox10 ShowOnMobile"></div>
                                <h:outputText value="Etapas y Tareas" styleClass="Fs25 FontBold Blue Fright MarTop5"  />
                            </div>
                        </f:facet>

                        <p:growl id="msgs" showDetail="true"/>

                        <p:panelGrid columns="2" layout="grid" styleClass="ui-grid-col-12 ui-panelgrid-blank MarBot10" columnClasses="ui-grid-col-4, ui-grid-col-8" >
                            <p:outputLabel value="Nombre de Etapa:" for="etapa" styleClass="FontBold Blue " />
                            <p:inputText id="etapa" value="#{etapaController.selected.etapa}" title="Etapa" styleClass="ui-grid-col-12">
                                <p:ajax event="keyup" update="btn_add"/>
                            </p:inputText>

                            <p:outputLabel value="Resultado Esperado:" for="etapa"  styleClass="FontBold Blue"/>
                            <p:inputTextarea id="resultadoesperado" rows="4" value="#{etapaController.selected.resultadoesperado}" title="Etapa" styleClass="ui-grid-col-12"/>
                        </p:panelGrid>

                        <div class="Separator" />

                        <div class="CardTopic">
                            <i class="icon-task Fs30 Fleft MarRight10" style="padding-top: 5px;"></i>
                            <div class="EmptyBox10 ShowOnMobile"></div>
                            Agregar Tareas a la Etapa
                            <p:commandButton update=":formd:wizardtarea" id="btn_add"
                                             action="#{tareaController.rearmarTareasProyecto}"
                                             onclick="PF('dtarea').show();" title="Agregar Tarea" immediate="true" icon="fa fa-plus"
                                             disabled="${empty etapaController.selected.etapa ? 'true' : 'false'}"
                                             style="margin-top: 5px; margin-bottom: 5px;" styleClass="GreenButton White"  />

                            <p:tooltip for="btn_add" />
                        </div>

                        <p:dataTable id="tareasdeproyecto" value="#{tareaController.tareasdeproyecto}" var="item"
                                     widgetVar="wtareasdeproyecto" styleClass="tabla tablaAjustada ui-grid-col-12" emptyMessage="No hay tareas cargadas en la etapa actual.">

                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Tarea"/>
                                </f:facet>
                                <p:outputLabel value="#{item.tarea}" styleClass="Celeste"/>
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Inicio"/>
                                </f:facet>
                                <p:outputLabel value="#{item.fechainicio}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>

                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    <h:outputText value="Fin"/>
                                </f:facet>
                                <p:outputLabel value="#{item.fechafin}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </p:outputLabel>

                            </p:column>

                            <p:column exportable="false">

                                <p:commandButton id="cborrar" immediate="true" title="Eliminar"
                                                 action="#{tareaController.removerTareadeProyecto}"
                                                 update=":forme:tareasdeproyecto :form:beanvalue :form:tabview1:treetableetapas " icon="fa fa-trash" styleClass="RedButton White">
                                    <f:setPropertyActionListener value="#{item}" target="#{tareaController.selected}"/>
                                </p:commandButton>
                                <p:tooltip for="cborrar" />
                                <br/>
                                <p:commandButton id="ceditar" immediate="true" title="Editar"
                                                 onclick="PF('dtarea').show()" update=":formd:wizardtarea"
                                                 action="#{tareaController.editarTarea(item)}" icon="fa fa-edit" styleClass="OrangeButton White">
                                    <f:setPropertyActionListener value="#{item}" target="#{tareaController.selected}"/>
                                </p:commandButton>
                                <p:tooltip for="ceditar" />
                            </p:column>

                        </p:dataTable>

                        <div align="center">
                            <p:commandButton id="cetapa"
                                             update=":form:tabview1:contenedor :form:tabview1:treetableetapas :form:beanvalue :form:tabview1:tablepresupuesto "
                                             onclick="PF('dialogoetapa').hide();
                                        crearGrafico();" value="Guardar Etapa"
                                             actionListener="#{etapaController.agregaralListadoEtapas}" icon="fa fa-save" styleClass="GreenButton White TexAlCenter" style="margin-top: 10px;"/>
                        </div>

                    </p:dialog>


                    <p:dialog id="dfinal" widgetVar="dfinal" modal="true" closable="false"
                              header="Plan y equipo de trabajo de Proyecto Creado">
                        Felicitaciones la Creación del plan y Equipo de trabajo del Proyecto fue creada Satisfactoriamente!!!
                        <div align="center">
                            <h:panelGrid columns="2">
                                <p:commandButton value="Imprimir" actionListener="#{proyectoController.pdfEtapas()}"
                                                 ajax="false"/>
                                <p:commandButton value="OK" ajax="false"
                                                 actionListener="#{proyectoController.reiniciarValoresProyecto}"
                                                 action="List" onclick="PF('dfinal').hide();"/>
                            </h:panelGrid>
                        </div>
                    </p:dialog>

                </h:form>

                <!--***************************************************-->
                <!--************ DIALOGO ITEM PRESUPUESTO ************* -->
                <!--***************************************************-->

                <h:form id="formpresupuesto" >
                    <p:dialog id="dialogopresupuesto" widgetVar="dialogopresupuesto"
                              maximizable="false" minimizable="false"
                              closable="true" resizable="false"
                              responsive="true"  >

                        <f:facet name="header">
                            <div class="CardTopic">
                                <i class="icon-list Fs30 Fleft MarRight10"></i>
                                <div class="EmptyBox10 ShowOnMobile"></div>
                                <h:outputText value="Nuevo Item en Presupuesto" styleClass="Fs25 FontBold Blue Fright MarTop5"  />
                            </div>
                        </f:facet>

                        <p:panel id="panelpresupuesto" style="border: none;" >

                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank" columnClasses="ui-grid-col-4 FontBold, ui-grid-col-8"  >

                                <p:outputLabel value="Rubro:" for="rubroItem" />
                                <p:selectOneMenu id="rubroItem"
                                                 value="#{presupuestoTareaController.selected.rubro}"
                                                 filter="true"
                                                 filterMatchMode="contains" styleClass="ui-grid-col-12" >
                                    <f:selectItems value="#{rubroController.rubroslist}" />
                                </p:selectOneMenu>

                                <p:outputLabel value="Descripcion:" for="descripcion"/>
                                <p:inputText id="descripcion"
                                             value="#{presupuestoTareaController.selected.descripcion}" required="true"
                                             title="Descripcion" styleClass="ui-grid-col-12" />

                                <p:outputLabel value="Costo unitario:" for="costounitario"/>
                                <p:inputText id="costounitario"
                                             value="#{presupuestoTareaController.selected.costounitario}"
                                             title="Costounitario" styleClass="ui-grid-col-12">
                                    <f:convertNumber type="number" groupingUsed="false" locale="es_AR"/>
                                    <p:ajax event="keyup" listener="#{presupuestoTareaController.sumarTotalCurrent}"
                                            update="totalpresupuesto"/>
                                </p:inputText>

                                <p:outputLabel value="Cantidad:" for="cantidad"/>
                                <p:inputText size="10" id="cantidad" value="#{presupuestoTareaController.selected.cantidad}"
                                             title="Cantidad" styleClass="ui-grid-col-12">
                                    <f:convertNumber type="number" groupingUsed="false" locale="es_AR"/>
                                    <p:ajax event="keyup" listener="#{presupuestoTareaController.sumarTotalCurrent}"
                                            update="totalpresupuesto"/>
                                </p:inputText>

                                <p:outputLabel value="Total:" for="totalpresupuesto"/>
                                <p:outputLabel id="totalpresupuesto" value="$#{presupuestoTareaController.selected.total}" title="Total" />

                            </p:panelGrid>

                            <div class="Separator" />

                            <p:panelGrid columns="2" layout="grid" styleClass="ui-panelgrid-blank" columnClasses="ui-grid-col-4 FontBold, ui-grid-col-8" style="padding-top: 10px;"  >

                                <p:outputLabel value="Aporte universidad:" for="aporteuniversidad"/>
                                <p:inputText id="aporteuniversidad"
                                             value="#{presupuestoTareaController.selected.aporteuniversidad}"
                                             title="Aporteuniversidad" styleClass="ui-grid-col-12">
                                    <f:convertNumber type="number" groupingUsed="false" locale="es_AR"/>
                                    <p:ajax event="keyup" listener="#{presupuestoTareaController.verificarAportes}"/>
                                </p:inputText>

                                <p:outputLabel value="Aporte organismo:" for="aporteorganismo"/>
                                <p:inputText id="aporteorganismo"
                                             value="#{presupuestoTareaController.selected.aporteorganismo}"
                                             title="Aporteorganismo" styleClass="ui-grid-col-12">
                                    <f:convertNumber type="number" groupingUsed="false" locale="es_AR"/>
                                    <p:ajax event="keyup" listener="#{presupuestoTareaController.verificarAportes}"/>
                                </p:inputText>

                                <p:outputLabel value="Aporte comitente:" for="aportecomitente"/>
                                <p:inputText id="aportecomitente"
                                             value="#{presupuestoTareaController.selected.aportecomitente}"
                                             title="Aportecomitente" validatorMessage="Ingrese solo números" styleClass="ui-grid-col-12">
                                    <f:convertNumber type="number" groupingUsed="false" locale="es_AR"/>
                                    <p:ajax event="keyup" listener="#{presupuestoTareaController.verificarAportes}"/>
                                </p:inputText>

                            </p:panelGrid>

                            <div class="Separator" />

                            <div align="center">
                                <p:commandButton id="agregaralpresupuesto" value="Agregar Item al Presupuesto"
                                                 onclick="PF('dialogopresupuesto').hide()"
                                                 actionListener="#{presupuestoTareaController.agregarPresupuesto()}" icon="fa fa-save" styleClass="GreenButton White"
                                                 update=":formpresupuesto:panelpresupuesto :form:tabview1:tablepresupuesto :form:tabview1:pchartpresupuesto :form:tabview1:chartaportes :form:tabview1:chartrubros :formd:wizardtarea:tablepresupuestotarea">
                                </p:commandButton>
                            </div>
                        </p:panel>
                    </p:dialog>
                </h:form>

                <!--****************************************-->
                <!--****** DIALOGO REGISTRAR AGENTE ********-->
                <!--****************************************-->

                <h:form id="formresgistrar">
                    <p:dialog id="dialogoregistrar" maximizable="false"
                              minimizable="false" header="Registrar Persona" closable="true"
                              resizable="false" widgetVar="dregistrar" responsive="true">

                        <p:remoteCommand name="rc" update="mensajesRegistrarAgente" actionListener="#{agenteViewController.registrar}"/>

                        <p:growl id="mensajesRegistrarAgente" showDetail="true"/>

                        <p:panelGrid id="panel" columns="3" layout="grid" styleClass="ui-panelgrid-blank">
                            <p:outputLabel value="Apellido" for="apellido"/>
                            <p:inputText maxlength="30" id="apellido" value="#{agenteViewController.agente1.apellido}"
                                         title="Apellido" required="true"/>
                            <p:message for="apellido"/>
                            <p:outputLabel value="Nombres" for="nombres"/>
                            <p:inputText maxlength="45" id="nombres" value="#{agenteViewController.agente1.nombres}"
                                         title="Nombres" required="true"/>
                            <p:message for="nombres"/>
                            <p:outputLabel value="Tipo de Documento" for="tipodocumentoid"/>
                            <p:selectOneMenu id="tipodocumentoid"
                                             value="#{agenteViewController.agente1.tipodocumentoid}"
                                             title="Tipo de Documento" required="true">
                                <f:selectItems value="#{tipodocumentoController.itemsAvailableSelectOne}"/>
                            </p:selectOneMenu>
                            <p:message for="tipodocumentoid"/>
                            <p:outputLabel value="N° de Documento" for="numerodocumento"/>
                            <p:inputText id="numerodocumento" value="#{agenteViewController.agente1.numerodocumento}"
                                         title="Numero de Documento" required="true"/>
                            <p:message for="numerodocumento"/>
                            <p:outputLabel value="Cuil" for="cuil"/>
                            <p:inputMask id="cuil" value="#{agenteViewController.agente1.cuil}" mask="99-99999999-9"/>
                            <p:message for="cuil"/>
                            <p:outputLabel value="Teléfono" for="telefono"/>
                            <p:inputText id="telefono" value="#{agenteViewController.agente1.telefono}" title="Telefono"
                                         required="true"/>
                            <p:message for="telefono"/>
                            <p:outputLabel value="Celular" for="celular"/>
                            <p:inputText id="celular" value="#{agenteViewController.agente1.celular}" title="Celular"
                                         required="false"/>
                            <p:message for="celular"/>
                            <p:outputLabel value="Email" for="email"/>
                            <p:inputText id="email" value="#{agenteViewController.agente1.email}"
                                         validatorMessage="Email Incorrecto" required="true">
                                <f:validateRegex
                                        pattern="[\w\.-]*[a-zA-Z0-9_]@[\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]"/>
                            </p:inputText>
                            <p:message for="email"/>
                            <p:outputLabel value="Otro Email" for="otroemail"/>

                            <p:inputText id="otroemail" value="#{agenteViewController.agente1.otroemail}">
                                <!--   <f:validateRegex pattern="[\w\.-]*[a-zA-Z0-9_]@[\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]" /> -->
                            </p:inputText>
                            <p:message for="otroemail"/>

                            <p:outputLabel value="Domicilio" for="domicilio"/>
                            <p:inputText maxlength="200" id="domicilio"
                                         value="#{agenteViewController.agente1.domicilio}" title="Domicilio"
                                         required="true"/>
                            <p:message for="domicilio"/>
                            <p:outputLabel value="Profesion" for="profesion"/>
                            <p:inputText maxlength="70" id="profesion" value="#{agenteViewController.agente1.profesion}"
                                         title="Profesion" required="true"/>
                            <p:message for="profesion"/>
                            <p:outputLabel value="Especialidad" for="especialidad"/>
                            <p:inputText maxlength="70" id="especialidad"
                                         value="#{agenteViewController.agente1.especialidad}" title="Especialidad"
                                         required="true"/>
                            <p:message for="especialidad"/>

                            <p:commandButton onclick="rc()" oncomplete="PF('dregistrar').hide()"
                                             update=":formd:wizardtarea:advancedfiltro :form:tabview1:advancedfiltroa"
                                             value="Crear"/>
                            <br/>

                        </p:panelGrid>


                    </p:dialog>

                </h:form>

                <script type="text/javascript">
                    $(function crearGrafico() {
                        var chart;

                        chart = new Highcharts.Chart({
                            chart: {
                                renderTo: "containergrafico",
                                type: 'columnrange',
                                inverted: true
                            },
                            exporting: {
                                enabled: true
                            },
                            title: {
                                text: ''
                            },
                            xAxis: {
                                categories: []

                            },
                            yAxis: {
                                tickInterval: 7 * 24 * 3600 * 1000,
                                title: 'Date',
                                type: 'datetime',
                                dateTimeLabelFormats: {
                                    week: '%e. %b'
                                },
                                stackLabels: {
                                    style: {
                                        color: 'white'
                                    },
                                    enabled: true,
                                    verticalAlign: 'middle',
                                    align: 'left'
                                }
                            },
                            tooltip: {
                                formatter: function () {

                                    return '<b>' + this.series.name + ':</b> ' + Highcharts.dateFormat('%e %b, %Y', this.point.low) + ' - ' + Highcharts.dateFormat('%e %b, %Y', this.point.high) + '<br/>';
                                }
                            },
                            legend: {
                                enabled: true
                            },
                            plotOptions: {
                                series: {
                                    color: '#439fe0'
                                }
                            },
                            series: [{
                                name: 'Inicio - Fin',
                                data: #{etapaController.data}
                            }, {
                                name: 'Actual',
                                data: #{etapaController.dataactual},
                                color: 'yellow'
                            }]
                        });
                        Highcharts.setOptions({
                            lang: {
                                loading: 'Cargando...',
                                months: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                                weekdays: ['Domingo', 'Lunes', 'Martes', 'Miercoles', 'Jueves', 'Viernes', 'Sábado'],
                                shortMonths: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
                                exportButtonTitle: 'Exportar',
                                printButtonTitle: 'Importar',
                                rangeSelectorFrom: 'De',
                                rangeSelectorTo: 'A',
                                rangeSelectorZoom: 'Periodo',
                                downloadPNG: 'Descargar gráfico PNG',
                                downloadJPEG: 'Descargar gráfico JPEG',
                                downloadPDF: 'Descargar gráfico PDF',
                                downloadSVG: 'Descargar gráfico SVG',
                                printChart: 'Imprimir Gráfico',
                                thousandsSep: ',',
                                decimalPoint: '.'
                            }
                        });
                        //chart.series[1].setData(eval(oneArray), false, true);
                        // chart.series[0].setData(, false, true);
                        chart.xAxis[0].setCategories(#{etapaController.gsoncategoria}, true, true);
                    });
                </script>
                <script type="text/javascript">
                    function handleTareaAgentePresupuestoRequest(xhr, status, args) {
                        if (!args.validation) {
                            PF('dialogotareaagentepresupuesto').jq.effect("shake", {times: 5}, 100);
                        }
                        else {
                            PF('dialogotareaagentepresupuesto').hide();

                        }
                    }
                </script>

                <!--Validar tabView de nueva tarea-->
                <script type="text/javascript">
                    //<![CDATA[
                    $(function() {
                        $.extend(PF("wizardtarea"), {
                            onTabChange : function(tabIndex) {
                                var $this = this;

                                if (!$this.validated) {
                                    PrimeFaces.ajax.Request.handle({
                                        source  : $this.id,
                                        process : $this.panelContainer.children().eq($this.cfg.selected).attr("id"),
                                        update  : $this.id,
                                        oncomplete : function(xhr, status, args) {
                                            if (!args.validationFailed) {
                                                $this.validated = true;
                                                $this.select(tabIndex);
                                            }
                                        }
                                    });

                                    return false;
                                }
                                else {
                                    delete $this.validated;

                                    return true
                                }
                            }
                        });
                    });
                    //]]>
                </script>
            </div>
        </div>
    </ui:define>
</ui:composition>

</html>
